/* Global Croplands - 2016-04-13
* http://www.Croplands.org
* Copyright (c) 2016 Justin Poehnelt;
* Last Modified: Wed Apr 13 2016 15:13:44
*/
!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=500,m=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var l,o,p,q=this,r=b.type,s=!1,t=function(){n(q,"writestart progress write writeend".split(" "))},u=function(){if((s||!l)&&(l=c().createObjectURL(b)),o)o.location.href=l;else{var d=a.open(l,"_blank");void 0==d&&"undefined"!=typeof safari&&(a.location.href=l)}q.readyState=q.DONE,t(),m(l)},v=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},w={create:!0,exclusive:!1};return q.readyState=q.INIT,i||(i="download"),e?(l=c().createObjectURL(b),d.href=l,d.download=i,f(d),q.readyState=q.DONE,t(),void m(l)):(a.chrome&&r&&r!==j&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=b.size,void h(a.TEMPORARY,k,v(function(a){a.root.getDirectory("saved",w,v(function(a){var c=function(){a.getFile(i,w,v(function(a){a.createWriter(v(function(c){c.onwriteend=function(b){o.location.href=a.toURL(),q.readyState=q.DONE,n(q,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),u)}),u)};a.getFile(i,{create:!1},v(function(a){a.remove(),c()}),v(function(a){a.code===a.NOT_FOUND_ERR?c():u()}))}),u)}),u)):void u())},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(a,b,c,d,e){var f;return{restrict:"EA",replace:!0,scope:{center:"=center",defaults:"=defaults",maxbounds:"=maxbounds",bounds:"=bounds",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",decorations:"=decorations",eventBroadcast:"=eventBroadcast"},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(b){f=a.defer(),this.getMap=function(){return f.promise},this.getLeafletScope=function(){return b}}],link:function(a,g,h){var i=d.isDefined,j=c.setDefaults(a.defaults,h.id),k=e.genDispatchMapEvent,l=e.getAvailableMapEvents();i(h.width)&&(isNaN(h.width)?g.css("width",h.width):g.css("width",h.width+"px")),i(h.height)&&(isNaN(h.height)?g.css("height",h.height):g.css("height",h.height+"px"));var m=new L.Map(g[0],c.getMapCreationDefaults(h.id));if(f.resolve(m),i(h.center)||m.setView([j.center.lat,j.center.lng],j.center.zoom),!i(h.tiles)&&!i(h.layers)){var n=L.tileLayer(j.tileLayer,j.tileLayerOptions);n.addTo(m),b.setTiles(n,h.id)}if(i(m.zoomControl)&&i(j.zoomControlPosition)&&m.zoomControl.setPosition(j.zoomControlPosition),i(m.zoomControl)&&j.zoomControl===!1&&m.zoomControl.removeFrom(m),i(m.zoomsliderControl)&&i(j.zoomsliderControl)&&j.zoomsliderControl===!1&&m.zoomsliderControl.removeFrom(m),!i(h.eventBroadcast))for(var o="broadcast",p=0;p<l.length;p++){var q=l[p];m.on(q,k(a,q,o),{eventName:q})}m.whenReady(function(){b.setMap(m,h.id)}),a.$on("$destroy",function(){m.remove(),b.unresolveMap(h.id)})}}}]),angular.module("leaflet-directive").directive("center",["$log","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(a,b,c,d,e,f,g,h){var i,j=f.isDefined,k=f.isNumber,l=f.isSameCenterOnMap,m=f.safeApply,n=f.isValidCenter,o=f.isEmpty,p=f.isUndefinedOrEmpty,q=function(a,b){return j(a)&&!o(a)&&p(b)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){i=b.defer(),this.getCenter=function(){return i.promise}},link:function(b,f,o,p){var r=p.getLeafletScope(),s=r.center;p.getMap().then(function(f){var p=e.getDefaults(o.id);if(-1!==o.center.search("-"))return a.error('The "center" variable can\'t use a "-" on his key name: "'+o.center+'".'),void f.setView([p.center.lat,p.center.lng],p.center.zoom);if(q(r.bounds,s))f.fitBounds(g.createLeafletBounds(r.bounds)),s=f.getCenter(),m(r,function(a){a.center={lat:f.getCenter().lat,lng:f.getCenter().lng,zoom:f.getZoom(),autoDiscover:!1}}),m(r,function(a){var b=f.getBounds(),c={northEast:{lat:b._northEast.lat,lng:b._northEast.lng},southWest:{lat:b._southWest.lat,lng:b._southWest.lng}};a.bounds=c});else{if(!j(s))return a.error('The "center" property is not defined in the main scope'),void f.setView([p.center.lat,p.center.lng],p.center.zoom);j(s.lat)&&j(s.lng)||j(s.autoDiscover)||angular.copy(p.center,s)}var t,u;if("yes"===o.urlHashCenter){var v=function(){var a,b=c.search();if(j(b.c)){var d=b.c.split(":");3===d.length&&(a={lat:parseFloat(d[0]),lng:parseFloat(d[1]),zoom:parseInt(d[2],10)})}return a};t=v(),r.$on("$locationChangeSuccess",function(a){var b=a.currentScope,c=v();j(c)&&!l(c,f)&&(b.center={lat:c.lat,lng:c.lng,zoom:c.zoom})})}r.$watch("center",function(b){return j(t)&&(angular.copy(t,b),t=void 0),n(b)||b.autoDiscover===!0?b.autoDiscover===!0?(k(b.zoom)||f.setView([p.center.lat,p.center.lng],p.center.zoom),void(k(b.zoom)&&b.zoom>p.center.zoom?f.locate({setView:!0,maxZoom:b.zoom}):j(p.maxZoom)?f.locate({setView:!0,maxZoom:p.maxZoom}):f.locate({setView:!0}))):void(u&&l(b,f)||(r.settingCenterFromScope=!0,f.setView([b.lat,b.lng],b.zoom),h.notifyCenterChangedToBounds(r,f),d(function(){r.settingCenterFromScope=!1}))):void a.warn("[AngularJS - Leaflet] invalid 'center'")},!0),f.whenReady(function(){u=!0}),f.on("moveend",function(){i.resolve(),h.notifyCenterUrlHashChanged(r,f,o,c.search()),l(s,f)||b.settingCenterFromScope||m(r,function(a){r.settingCenterFromScope||(a.center={lat:f.getCenter().lat,lng:f.getCenter().lng,zoom:f.getZoom(),autoDiscover:!1}),h.notifyCenterChangedToBounds(r,f)})}),s.autoDiscover===!0&&f.on("locationerror",function(){a.warn("[AngularJS - Leaflet] The Geolocation API is unauthorized on this page."),n(s)?(f.setView([s.lat,s.lng],s.zoom),h.notifyCenterChangedToBounds(r,f)):(f.setView([p.center.lat,p.center.lng],p.center.zoom),h.notifyCenterChangedToBounds(r,f))})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,f,g,h){var i=d.isDefined,j=h.getLeafletScope(),k=j.tiles;return i(k)||i(k.url)?void h.getMap().then(function(a){var d,e=c.getDefaults(g.id);j.$watch("tiles",function(c){var f=e.tileLayerOptions,h=e.tileLayer;return!i(c.url)&&i(d)?void a.removeLayer(d):i(d)?i(c.url)&&i(c.options)&&!angular.equals(c.options,f)?(a.removeLayer(d),f=e.tileLayerOptions,angular.copy(c.options,f),h=c.url,d=L.tileLayer(h,f),d.addTo(a),void b.setTiles(d,g.id)):void(i(c.url)&&d.setUrl(c.url)):(i(c.options)&&angular.copy(c.options,f),i(c.url)&&(h=c.url),d=L.tileLayer(h,f),d.addTo(a),void b.setTiles(d,g.id))},!0)}):void a.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),angular.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,f,g,h){var i,j=c.isArray,k=c.isDefined,l=c.isFunction,m=h.getLeafletScope(),n=m.legend,o=n.legendClass?n.legendClass:"legend",p=n.position||"bottomright";h.getMap().then(function(c){m.$watch("legend",function(b){k(b.url)||j(b.colors)&&j(b.labels)&&b.colors.length===b.labels.length?k(b.url)?a.info("[AngularJS - Leaflet] loading arcgis legend service."):(k(i)&&i.removeFrom(c),i=L.control({position:p}),i.onAdd=d.getOnAddArrayLegend(b,o),i.addTo(c)):a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}),m.$watch("legend.url",function(e){k(e)&&b.get(e).success(function(a){k(i)?d.updateArcGISLegend(i.getContainer(),a):(i=L.control({position:p}),i.onAdd=d.getOnAddArcGISLegend(a,o),i.addTo(c)),k(n.loadedData)&&l(n.loadedData)&&n.loadedData()}).error(function(){a.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,e,f,g){var h=d.safeApply,i=d.isDefined,j=g.getLeafletScope(),k={};g.getMap().then(function(a){j.$watch("geojson",function(e){if(i(k)&&a.hasLayer(k)&&a.removeLayer(k),i(e)&&i(e.data)){var g=e.resetStyleOnMouseout,l=e.onEachFeature;l||(l=function(a,c){d.LabelPlugin.isLoaded()&&i(e.label)&&c.bindLabel(a.properties.description),c.on({mouseover:function(c){h(j,function(){e.selected=a,b.$broadcast("leafletDirectiveMap.geojsonMouseover",c)})},mouseout:function(a){g&&k.resetStyle(a.target),h(j,function(){e.selected=void 0,b.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(c){h(j,function(){e.selected=a,b.$broadcast("leafletDirectiveMap.geojsonClick",e.selected,c)})}})}),e.options={style:e.style,filter:e.filter,onEachFeature:l,pointToLayer:e.pointToLayer},k=L.geoJson(e.data,e.options),c.setGeoJSON(k,f.id),k.addTo(a)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(a,b,c,d,e,f){var g;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){g=b.defer(),this.getLayers=function(){return g.promise}},link:function(b,h,i,j){var k=d.isDefined,l={},m=j.getLeafletScope(),n=m.layers,o=e.createLayer,p=f.updateLayersControl,q=!1;j.getMap().then(function(b){if(!k(n)||!k(n.baselayers)||0===Object.keys(n.baselayers).length)return void a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");g.resolve(l),c.setLayers(l,i.id),l.baselayers={},l.overlays={};var d=i.id,e=!1;for(var f in n.baselayers){var h=o(n.baselayers[f]);k(h)?(l.baselayers[f]=h,n.baselayers[f].top===!0&&(b.addLayer(l.baselayers[f]),e=!0)):delete n.baselayers[f]}!e&&Object.keys(l.baselayers).length>0&&b.addLayer(l.baselayers[Object.keys(n.baselayers)[0]]);for(f in n.overlays){"cartodb"===n.overlays[f].type;var j=o(n.overlays[f]);k(j)?(l.overlays[f]=j,n.overlays[f].visible===!0&&b.addLayer(l.overlays[f])):delete n.overlays[f]}m.$watch("layers.baselayers",function(c){for(var e in l.baselayers)(!k(c[e])||c[e].refresh)&&(b.hasLayer(l.baselayers[e])&&b.removeLayer(l.baselayers[e]),delete l.baselayers[e]);for(var f in c)if(!k(l.baselayers[f])){var g=o(c[f]);k(g)&&(l.baselayers[f]=g,c[f].top===!0&&b.addLayer(l.baselayers[f]))}if(0===Object.keys(l.baselayers).length)return void a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");var h=!1;for(var i in l.baselayers)if(b.hasLayer(l.baselayers[i])){h=!0;break}h||b.addLayer(l.baselayers[Object.keys(n.baselayers)[0]]),q=p(b,d,q,c,n.overlays,l)},!0),m.$watch("layers.overlays",function(a){for(var c in l.overlays)(!k(a[c])||a[c].refresh)&&(b.hasLayer(l.overlays[c])&&b.removeLayer(l.overlays[c]),delete l.overlays[c]);for(var e in a){if(k(l.overlays[e]))a[e].layerOptions&&a[e].layerOptions.opacity&&l.overlays[e].options.opacity!=a[e].layerOptions.opacity&&l.overlays[e].setOpacity(a[e].layerOptions.opacity),a[e].layerOptions&&a[e].layerOptions.zIndex&&l.overlays.options.zIndex!=a[e].layerOptions.zIndex&&l.overlays.setZIndex(a[e].layerOptions.zIndex);else{var f=o(a[e]);k(f)&&(l.overlays[e]=f,a[e].visible===!0&&b.addLayer(l.overlays[e]))}a[e].visible&&!b.hasLayer(l.overlays[e])?b.addLayer(l.overlays[e]):a[e].visible===!1&&b.hasLayer(l.overlays[e])&&b.removeLayer(l.overlays[e])}q=p(b,d,q,n.baselayers,a,l)},!0)})}}}]),angular.module("leaflet-directive").directive("bounds",["$log","$timeout","leafletHelpers","leafletBoundsHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","center"],link:function(e,f,g,h){var i=c.isDefined,j=d.createLeafletBounds,k=h[0].getLeafletScope(),l=h[0],m=function(a){return 0===a._southWest.lat&&0===a._southWest.lng&&0===a._northEast.lat&&0===a._northEast.lng?!0:!1};l.getMap().then(function(c){k.$on("boundsChanged",function(a){var b=a.currentScope,d=c.getBounds();if(!m(d)&&!b.settingBoundsFromScope){var e={northEast:{lat:d._northEast.lat,lng:d._northEast.lng},southWest:{lat:d._southWest.lat,lng:d._southWest.lng}};angular.equals(b.bounds,e)||(b.bounds=e)}}),k.$watch("bounds",function(d){if(!i(d))return void a.error("[AngularJS - Leaflet] Invalid bounds");var f=j(d);f&&!c.getBounds().equals(f)&&(e.settingBoundsFromScope=!0,c.fitBounds(f),b(function(){e.settingBoundsFromScope=!1}))},!0)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletEvents",function(a,b,c,d,e,f,g,h){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(b,f,i,j){var k=j[0],l=e,m=e.isDefined,n=e.isString,o=k.getLeafletScope(),p=g.deleteMarker,q=g.addMarkerWatcher,r=g.listenMarkerEvents,s=g.addMarkerToGroup,t=h.bindMarkerEvents,u=g.createMarker;k.getMap().then(function(b){var e,f={};e=m(j[1])?j[1].getLayers:function(){var a=c.defer();return a.resolve(),a.promise},e().then(function(c){d.setMarkers(f,i.id),o.$watch("markers",function(d){for(var e in f)p(f[e],b,c),delete f[e];for(var g in d)if(-1===g.search("-")){if(!m(f[g])){var h=d[g],j=u(h);if(!m(j)){a.error("[AngularJS - Leaflet] Received invalid data on the marker "+g+".");continue}if(f[g]=j,m(h.message)&&j.bindPopup(h.message,h.popupOptions),m(h.group)){var k=m(h.groupOption)?h.groupOption:null;s(j,h.group,k,b)}if(l.LabelPlugin.isLoaded()&&m(h.label)&&m(h.label.message)&&j.bindLabel(h.label.message,h.label.options),m(h)){if(!n(h.layer)){h.layer="locations";continue}if(!m(c)){h.layer="locations";continue}if(!m(c.overlays)||!m(c.overlays[h.layer])){a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var v=c.overlays[h.layer];if(!(v instanceof L.LayerGroup||v instanceof L.FeatureGroup)){a.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}v.addLayer(j),b.hasLayer(j)&&h.focus===!0&&j.openPopup()}else m(h.group)||(b.addLayer(j),h.focus===!0&&j.openPopup(),l.LabelPlugin.isLoaded()&&m(h.label)&&m(h.label.options)&&h.label.options.noHide===!0&&j.showLabel());var w=!m(i.watchMarkers)||"true"===i.watchMarkers;w&&(q(j,g,o,c,b),r(j,h,o)),t(j,g,h,o)}}else a.error('The marker can\'t use a "-" on his key name: "'+g+'".')},!0)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(a,b,c,d,e,f,g){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(h,i,j,k){var l=k[0],m=e.isDefined,n=e.isString,o=l.getLeafletScope(),p=o.paths,q=f.createPath,r=g.bindPathEvents,s=f.setPathOptions;l.getMap().then(function(f){var g,h=d.getDefaults(j.id);g=m(k[1])?k[1].getLayers:function(){var a=b.defer();return a.resolve(),a.promise},m(p)&&g().then(function(b){var d={};c.setPaths(d,j.id);var g=function(a,b){var c=o.$watch("paths."+b,function(b){return m(b)?void s(a,b.type,b):(f.removeLayer(a),void c())},!0)};o.$watch("paths",function(c){for(var i in c)if(0!==i.search("\\$"))if(-1===i.search("-")){if(!m(d[i])){var j=c[i],k=q(i,c[i],h);if(m(k)&&m(j.message)&&k.bindPopup(j.message),e.LabelPlugin.isLoaded()&&m(j.label)&&m(j.label.message)&&k.bindLabel(j.label.message,j.label.options),m(j)&&m(j.layer)){if(!n(j.layer)){a.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!m(b)){a.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!m(b.overlays)||!m(b.overlays[j.layer])){a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var l=b.overlays[j.layer];if(!(l instanceof L.LayerGroup||l instanceof L.FeatureGroup)){a.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}d[i]=k,l.addLayer(k),g(k,i)}else m(k)&&(d[i]=k,f.addLayer(k),g(k,i));r(k,i,j,o)}}else a.error('[AngularJS - Leaflet] The path name "'+i+'" is not valid. It must not include "-" and a number.');for(var p in d)m(c[p])||delete d[p]},!0)})})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(a,c,d,e){if(e){var f=b.isDefined,g=e.getLeafletScope(),h=g.controls;e.getMap().then(function(a){if(f(L.Control.Draw)&&f(h.draw)){var b=new L.FeatureGroup,c={edit:{featureGroup:b}};angular.extend(c,h.draw),h.draw=c,a.addLayer(c.edit.featureGroup);var d=new L.Control.Draw(c);a.addControl(d)}if(f(h.custom))for(var e in h.custom)a.addControl(h.custom[e])})}}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletEvents",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(b,e,f,g){var h=c.isObject,i=g.getLeafletScope(),j=d.getAvailableMapEvents(),k=d.genDispatchMapEvent;g.getMap().then(function(b){i.$watch("eventBroadcast",function(c){var d,e,f=[],g="broadcast";if(h(c)){if(void 0===c.map||null===c.map)f=j;else if("object"!=typeof c.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==c.map.logic&&null!==c.map.logic&&("emit"!==c.map.logic&&"broadcast"!==c.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===c.map.logic&&(g="emit"));var l=!1,m=!1;if(void 0!==c.map.enable&&null!==c.map.enable&&"object"==typeof c.map.enable&&(l=!0),void 0!==c.map.disable&&null!==c.map.disable&&"object"==typeof c.map.disable&&(m=!0),l&&m)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(l||m)if(l)for(d=0;d<c.map.enable.length;d++)e=c.map.enable[d],-1!==f.indexOf(e)?a.warn("[AngularJS - Leaflet] This event "+e+" is already enabled"):-1===j.indexOf(e)?a.warn("[AngularJS - Leaflet] This event "+e+" does not exist"):f.push(e);else for(f=j,d=0;d<c.map.disable.length;d++){e=c.map.disable[d];var n=f.indexOf(e);-1===n?a.warn("[AngularJS - Leaflet] This event "+e+" does not exist or has been already disabled"):f.splice(n,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(d=0;d<f.length;d++)e=f[d],b.on(e,k(i,e,g),{eventName:e})}else a.warn("[AngularJS - Leaflet] event-broadcast must be an object, check your model.")})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,b,d,e){var f=e.getLeafletScope(),g=c.isValidBounds;e.getMap().then(function(a){f.$watch("maxbounds",function(b){if(!g(b))return void a.setMaxBounds();var c=[[b.southWest.lat,b.southWest.lng],[b.northEast.lat,b.northEast.lng]];a.setMaxBounds(c),d.center||a.fitBounds(c)})})}}}]),angular.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(c,d,e,f){function g(b){return k(b)&&k(b.coordinates)&&(j.isLoaded()||a.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(b.coordinates)}function h(a,b){return k(a)&&k(b)&&k(b.coordinates)&&k(b.patterns)?(a.setPaths(b.coordinates),a.setPatterns(b.patterns),a):void 0}var i=f.getLeafletScope(),j=b.PolylineDecoratorPlugin,k=b.isDefined,l={};f.getMap().then(function(a){i.$watch("decorations",function(b){for(var c in l)k(b)&&k(b[c])||delete l[c],a.removeLayer(l[c]);for(var d in b){var e=b[d],f=g(e);k(f)&&(l[d]=f,a.addLayer(f),h(f,e))}},!0)})}}}]),angular.module("leaflet-directive").directive("layercontrol",["$log","leafletData","leafletHelpers",function(a,b,c){return{restrict:"E",scope:{},replace:!0,transclude:!1,require:"^leaflet",controller:["$scope","$element","$sce",function(d,e,f){a.debug("[Angular Directive - Layers] layers",d,e);var g=c.safeApply,h=c.isDefined;angular.extend(d,{baselayer:"",icons:{uncheck:"fa fa-check-square-o",check:"fa fa-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up"},changeBaseLayer:function(a,e){c.safeApply(d,function(c){c.baselayer=a,b.getMap().then(function(e){b.getLayers().then(function(b){if(!e.hasLayer(b.baselayers[a])){for(var f in c.layers.baselayers)c.layers.baselayers[f].icon=c.icons.unradio,e.hasLayer(b.baselayers[f])&&e.removeLayer(b.baselayers[f]);e.addLayer(b.baselayers[a]),c.layers.baselayers[a].icon=d.icons.radio}})})}),e.preventDefault()},moveLayer:function(a,b,c){var e=Object.keys(d.layers.baselayers).length;if(b>=1+e&&b<=d.overlaysArray.length+e){var f;for(var h in d.layers.overlays)if(d.layers.overlays[h].index===b){f=d.layers.overlays[h];break}f&&g(d,function(){f.index=a.index,a.index=b})}c.stopPropagation(),c.preventDefault()},initIndex:function(a,b){var c=Object.keys(d.layers.baselayers).length;a.index=h(a.index)?a.index:b+c+1},toggleOpacity:function(b,c){if(a.debug("Event",b),c.visible){var e=angular.element(b.currentTarget);e.toggleClass(d.icons.close+" "+d.icons.open),e=e.parents(".lf-row").find(".lf-opacity"),e.toggle("fast",function(){g(d,function(){c.opacityControl=!c.opacityControl})})}b.stopPropagation(),b.preventDefault()},unsafeHTML:function(a){return f.trustAsHtml(a)}});var i=e.get(0);L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"mousewheel",L.DomEvent.stopPropagation))}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"><div class="lf-baselayers"><div class="lf-row" ng-repeat="(key, layer) in layers.baselayers"><label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"><input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ng-show="false" ng-checked="baselayer === key" ng-value="key" /> <i class="lf-icon lf-icon-radio" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label></div></div><div class="lf-overlays"><div class="lf-container"><div class="lf-row" ng-repeat="layer in overlaysArray | orderBy:\'index\':order" ng-init="initIndex(layer, $index)"><label class="lf-icon-ol"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> <i class="lf-icon lf-icon-check" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div><div class="lf-icons"><i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"></i> <i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"></i> <i class="lf-icon lf-open" ng-class="layer.opacityControl? icons.close:icons.open" ng-click="toggleOpacity($event, layer)"></i></div></label><div class="lf-legend" ng-if="layer.legend" ng-bind-html="unsafeHTML(layer.legend)"></div><div class="lf-opacity" ng-show="layer.visible &amp;&amp; layer.opacityControl"><input type="text" class="lf-opacity-control" name="lf-opacity-control" data-key="{{layer.index}}" /></div></div></div></div></div>',link:function(d,e,f,g){var h=c.isDefined,i=g.getLeafletScope(),j=i.layers;f.order=!h(f.order)||"normal"!==f.order&&"reverse"!==f.order?"normal":f.order,d.order="normal"===f.order,d.orderNumber="normal"===f.order?-1:1,d.layers=j,g.getMap().then(function(c){return h(j)&&h(j.baselayers)&&0!==Object.keys(j.baselayers).length?(i.$watch("layers.baselayers",function(a){b.getLayers().then(function(b){var e;for(e in a)c.hasLayer(b.baselayers[e])?a[e].icon=d.icons.radio:a[e].icon=d.icons.unradio})}),void i.$watch("layers.overlays",function(f){var g=[];b.getLayers().then(function(a){for(var b in f)f[b].icon=d.icons[f[b].visible?"uncheck":"check"],g.push(f[b]),h(f[b].index)&&a.overlays[b].setZIndex&&a.overlays[b].setZIndex(f[b].index)});var i=d.$watch(function(){return e.children().size()>1?(e.find(".lf-overlays").trigger("resize"),e.find(".lf-opacity").size()===Object.keys(j.overlays).length):void 0},function(f){f===!0&&(h(e.find(".lf-opacity-control").ionRangeSlider)?e.find(".lf-opacity-control").each(function(a,e){var f,g=Object.keys(j.baselayers).length;for(var i in d.overlaysArray)d.overlaysArray[i].index===a+g+1&&(f=d.overlaysArray[i]);var k=angular.element(e),l=h(f)&&h(f.layerOptions)?f.layerOptions.opacity:void 0;k.ionRangeSlider({min:0,from:h(l)?Math.ceil(100*l):100,step:1,max:100,prettify:!1,hasGrid:!1,hideMinMax:!0,onChange:function(a){b.getLayers().then(function(b){var d,e,f=a.input.data().key;for(var g in j.overlays)if(j.overlays[g].index===f){d=b.overlays[g],e=j.overlays[g];break}c.hasLayer(d)&&(e.layerOptions=h(e.layerOptions)?e.layerOptions:{},e.layerOptions.opacity=a.input.val()/100,d.setOpacity&&d.setOpacity(a.input.val()/100),d.getLayers&&d.eachLayer&&d.eachLayer(function(b){b.setOpacity&&b.setOpacity(a.input.val()/100)}))})}})}):a.warn("[AngularJS - Leaflet] Ion Slide Range Plugin is not loaded"),i())});d.overlaysArray=g},!0)):void a.error("[AngularJS - Leaflet] At least one baselayer has to be defined")})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(a,b,c){var d=c.getDefer,e=c.getUnresolvedDefer,f=c.setResolvedDefer,g={},h={},i={},j={},k={},l={},m={},n={};this.setMap=function(a,b){var c=e(g,b);c.resolve(a),f(g,b)},this.getMap=function(a){var b=d(g,a);return b.promise},this.unresolveMap=function(a){var b=c.obtainEffectiveMapId(g,a);g[b]=void 0},this.getPaths=function(a){var b=d(j,a);return b.promise},this.setPaths=function(a,b){var c=e(j,b);c.resolve(a),f(j,b)},this.getMarkers=function(a){var b=d(k,a);return b.promise},this.setMarkers=function(a,b){var c=e(k,b);c.resolve(a),f(k,b)},this.getLayers=function(a){var b=d(i,a);return b.promise},this.setLayers=function(a,b){var c=e(i,b);c.resolve(a),f(i,b)},this.getUTFGrid=function(a){var b=d(m,a);return b.promise},this.setUTFGrid=function(a,b){var c=e(m,b);c.resolve(a),f(m,b)},this.setTiles=function(a,b){var c=e(h,b);c.resolve(a),f(h,b)},this.getTiles=function(a){var b=d(h,a);return b.promise},this.setGeoJSON=function(a,b){var c=e(l,b);c.resolve(a),f(l,b)},this.getGeoJSON=function(a){var b=d(l,a);return b.promise},this.setDecorations=function(a,b){var c=e(n,b);c.resolve(a),f(n,b)},this.getDecorations=function(a){var b=d(n,a);return b.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(a,b){function c(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,touchZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var d=b.isDefined,e=b.isObject,f=b.obtainEffectiveMapId,g={};return{getDefaults:function(a){var b=f(g,a);return g[b]},getMapCreationDefaults:function(a){var b=f(g,a),c=g[b],e={maxZoom:c.maxZoom,keyboard:c.keyboard,dragging:c.dragging,zoomControl:c.zoomControl,doubleClickZoom:c.doubleClickZoom,scrollWheelZoom:c.scrollWheelZoom,touchZoom:c.touchZoom,attributionControl:c.attributionControl,worldCopyJump:c.worldCopyJump,crs:c.crs};if(d(c.minZoom)&&(e.minZoom=c.minZoom),d(c.zoomAnimation)&&(e.zoomAnimation=c.zoomAnimation),d(c.fadeAnimation)&&(e.fadeAnimation=c.fadeAnimation),d(c.markerZoomAnimation)&&(e.markerZoomAnimation=c.markerZoomAnimation),c.map)for(var h in c.map)e[h]=c.map[h];return e},setDefaults:function(a,b){var h=c();d(a)&&(h.doubleClickZoom=d(a.doubleClickZoom)?a.doubleClickZoom:h.doubleClickZoom,h.scrollWheelZoom=d(a.scrollWheelZoom)?a.scrollWheelZoom:h.doubleClickZoom,h.touchZoom=d(a.touchZoom)?a.touchZoom:h.doubleClickZoom,h.zoomControl=d(a.zoomControl)?a.zoomControl:h.zoomControl,h.zoomsliderControl=d(a.zoomsliderControl)?a.zoomsliderControl:h.zoomsliderControl,
h.attributionControl=d(a.attributionControl)?a.attributionControl:h.attributionControl,h.tileLayer=d(a.tileLayer)?a.tileLayer:h.tileLayer,h.zoomControlPosition=d(a.zoomControlPosition)?a.zoomControlPosition:h.zoomControlPosition,h.keyboard=d(a.keyboard)?a.keyboard:h.keyboard,h.dragging=d(a.dragging)?a.dragging:h.dragging,d(a.controls)&&angular.extend(h.controls,a.controls),e(a.crs)?h.crs=a.crs:d(L.CRS[a.crs])&&(h.crs=L.CRS[a.crs]),d(a.tileLayerOptions)&&angular.copy(a.tileLayerOptions,h.tileLayerOptions),d(a.maxZoom)&&(h.maxZoom=a.maxZoom),d(a.minZoom)&&(h.minZoom=a.minZoom),d(a.zoomAnimation)&&(h.zoomAnimation=a.zoomAnimation),d(a.fadeAnimation)&&(h.fadeAnimation=a.fadeAnimation),d(a.markerZoomAnimation)&&(h.markerZoomAnimation=a.markerZoomAnimation),d(a.worldCopyJump)&&(h.worldCopyJump=a.worldCopyJump),d(a.map)&&(h.map=a.map));var i=f(g,b);return g[i]=h,h}}}]),angular.module("leaflet-directive").factory("leafletEvents",["$rootScope","$q","$log","leafletHelpers",function(a,b,c,d){var e=d.safeApply,f=d.isDefined,g=d.isObject,h=d,i=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},j=function(a,b,c,d){for(var e=i(),f="markers."+d,g=0;g<e.length;g++){var h=e[g];c.label.on(h,m(a,h,b,c.label,f))}},k=function(b,c,d,f,g,h){return function(i){var j="leafletDirectiveMarker."+b;"click"===b?e(d,function(){a.$broadcast("leafletDirectiveMarkersClick",g)}):"dragend"===b&&(e(d,function(){h.lat=f.getLatLng().lat,h.lng=f.getLatLng().lng}),h.message&&h.focus===!0&&f.openPopup()),e(d,function(b){"emit"===c?b.$emit(j,{markerName:g,leafletEvent:i}):a.$broadcast(j,{markerName:g,leafletEvent:i})})}},l=function(b,c,d,f,g){return function(f){var h="leafletDirectivePath."+b;e(d,function(b){"emit"===c?b.$emit(h,{pathName:g,leafletEvent:f}):a.$broadcast(h,{pathName:g,leafletEvent:f})})}},m=function(b,c,d,f,g){return function(h){var i="leafletDirectiveLabel."+c,j=g.replace("markers.","");e(b,function(b){"emit"===d?b.$emit(i,{leafletEvent:h,label:f,markerName:j}):"broadcast"===d&&a.$broadcast(i,{leafletEvent:h,label:f,markerName:j})})}},n=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]},o=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},genDispatchMapEvent:function(b,c,d){return function(f){var g="leafletDirectiveMap."+c;e(b,function(b){"emit"===d?b.$emit(g,{leafletEvent:f}):"broadcast"===d&&a.$broadcast(g,{leafletEvent:f})})}},getAvailableMarkerEvents:n,getAvailablePathEvents:o,notifyCenterChangedToBounds:function(a){a.$broadcast("boundsChanged")},notifyCenterUrlHashChanged:function(a,b,c,d){if(f(c.urlHashCenter)){var e=b.getCenter(),g=e.lat.toFixed(4)+":"+e.lng.toFixed(4)+":"+b.getZoom();f(d.c)&&d.c===g||a.$emit("centerUrlHash",g)}},bindMarkerEvents:function(a,b,d,e){var i,l,m=[],o="broadcast";if(f(e.eventBroadcast))if(g(e.eventBroadcast))if(f(e.eventBroadcast.marker))if(g(e.eventBroadcast.marker)){void 0!==e.eventBroadcast.marker.logic&&null!==e.eventBroadcast.marker.logic&&("emit"!==e.eventBroadcast.marker.logic&&"broadcast"!==e.eventBroadcast.marker.logic?c.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===e.eventBroadcast.marker.logic&&(o="emit"));var p=!1,q=!1;if(void 0!==e.eventBroadcast.marker.enable&&null!==e.eventBroadcast.marker.enable&&"object"==typeof e.eventBroadcast.marker.enable&&(p=!0),void 0!==e.eventBroadcast.marker.disable&&null!==e.eventBroadcast.marker.disable&&"object"==typeof e.eventBroadcast.marker.disable&&(q=!0),p&&q)c.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||q)if(p)for(i=0;i<e.eventBroadcast.marker.enable.length;i++)l=e.eventBroadcast.marker.enable[i],-1!==m.indexOf(l)?c.warn("[AngularJS - Leaflet] This event "+l+" is already enabled"):-1===n().indexOf(l)?c.warn("[AngularJS - Leaflet] This event "+l+" does not exist"):m.push(l);else for(m=n(),i=0;i<e.eventBroadcast.marker.disable.length;i++){l=e.eventBroadcast.marker.disable[i];var r=m.indexOf(l);-1===r?c.warn("[AngularJS - Leaflet] This event "+l+" does not exist or has been already disabled"):m.splice(r,1)}else c.warn("[AngularJS - Leaflet] must enable or disable events")}else c.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else m=n();else c.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else m=n();for(i=0;i<m.length;i++)l=m[i],a.on(l,k(l,o,e,a,b,d));h.LabelPlugin.isLoaded()&&f(a.label)&&j(e,o,a,b)},bindPathEvents:function(a,b,d,e){var i,k,m=[],n="broadcast";if(f(e.eventBroadcast))if(g(e.eventBroadcast))if(f(e.eventBroadcast.path))if(g(e.eventBroadcast.paths))c.warn("[AngularJS - Leaflet] event-broadcast.path must be an object check your model.");else{void 0!==e.eventBroadcast.path.logic&&null!==e.eventBroadcast.path.logic&&("emit"!==e.eventBroadcast.path.logic&&"broadcast"!==e.eventBroadcast.path.logic?c.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===e.eventBroadcast.path.logic&&(n="emit"));var p=!1,q=!1;if(void 0!==e.eventBroadcast.path.enable&&null!==e.eventBroadcast.path.enable&&"object"==typeof e.eventBroadcast.path.enable&&(p=!0),void 0!==e.eventBroadcast.path.disable&&null!==e.eventBroadcast.path.disable&&"object"==typeof e.eventBroadcast.path.disable&&(q=!0),p&&q)c.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||q)if(p)for(i=0;i<e.eventBroadcast.path.enable.length;i++)k=e.eventBroadcast.path.enable[i],-1!==m.indexOf(k)?c.warn("[AngularJS - Leaflet] This event "+k+" is already enabled"):-1===o().indexOf(k)?c.warn("[AngularJS - Leaflet] This event "+k+" does not exist"):m.push(k);else for(m=o(),i=0;i<e.eventBroadcast.path.disable.length;i++){k=e.eventBroadcast.path.disable[i];var r=m.indexOf(k);-1===r?c.warn("[AngularJS - Leaflet] This event "+k+" does not exist or has been already disabled"):m.splice(r,1)}else c.warn("[AngularJS - Leaflet] must enable or disable events")}else m=o();else c.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else m=o();for(i=0;i<m.length;i++)k=m[i],a.on(k,l(k,n,e,m,b));h.LabelPlugin.isLoaded()&&f(a.label)&&j(e,n,a,b)}}}]),angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","leafletHelpers",function($rootScope,$log,leafletHelpers){function isValidLayerType(a){return isString(a.type)?-1===Object.keys(layerTypes).indexOf(a.type)?($log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes)),!1):layerTypes[a.type].mustHaveUrl&&!isString(a.url)?($log.error("[AngularJS - Leaflet] A base layer must have an url"),!1):layerTypes[a.type].mustHaveData&&!isDefined(a.data)?($log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):layerTypes[a.type].mustHaveLayer&&!isDefined(a.layer)?($log.error("[AngularJS - Leaflet] The type of layer "+a.type+" must have an layer defined"),!1):layerTypes[a.type].mustHaveBounds&&!isDefined(a.bounds)?($log.error("[AngularJS - Leaflet] The type of layer "+a.type+" must have bounds defined"),!1):layerTypes[a.type].mustHaveKey&&!isDefined(a.key)?($log.error("[AngularJS - Leaflet] The type of layer "+a.type+" must have key defined"),!1):!0:($log.error("[AngularJS - Leaflet] A layer must have a valid type defined."),!1)}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined,utfGridCreateLayer=function(a){if(!Helpers.UTFGridPlugin.isLoaded())return void $log.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.");var b=new L.UtfGrid(a.url,a.pluginOptions);return b.on("mouseover",function(a){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseover",a)}),b.on("mouseout",function(a){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseout",a)}),b.on("click",function(a){$rootScope.$broadcast("leafletDirectiveMap.utfgridClick",a)}),b},layerTypes={xyz:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer(a.url,a.options)}},mapbox:{mustHaveKey:!0,createLayer:function(a){var b="//{s}.tiles.mapbox.com/v3/"+a.key+"/{z}/{x}/{y}.png";return L.tileLayer(b,a.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(a){return Helpers.GeoJSONPlugin.isLoaded()?new L.TileLayer.GeoJSON(a.url,a.pluginOptions,a.options):void 0}},utfGrid:{mustHaveUrl:!0,createLayer:utfGridCreateLayer},cartodbTiles:{mustHaveKey:!0,createLayer:function(a){var b="//"+a.user+".cartodb.com/api/v1/map/"+a.key+"/{z}/{x}/{y}.png";return L.tileLayer(b,a.options)}},cartodbUTFGrid:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(a){return a.url="//"+a.user+".cartodb.com/api/v1/map/"+a.key+"/"+a.layer+"/{z}/{x}/{y}.grid.json",utfGridCreateLayer(a)}},cartodbInteractive:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(a){var b="//"+a.user+".cartodb.com/api/v1/map/"+a.key+"/{z}/{x}/{y}.png",c=L.tileLayer(b,a.options);a.url="//"+a.user+".cartodb.com/api/v1/map/"+a.key+"/"+a.layer+"/{z}/{x}/{y}.grid.json";var d=utfGridCreateLayer(a);return L.layerGroup([c,d])}},wms:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer.wms(a.url,a.options)}},wmts:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer.wmts(a.url,a.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(params){if(Helpers.WFSLayerPlugin.isLoaded()){var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}}},group:{mustHaveUrl:!1,createLayer:function(){return L.layerGroup()}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"SATELLITE";if(Helpers.GoogleLayerPlugin.isLoaded())return new L.Google(b,a.options)}},china:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"";if(Helpers.ChinaLayerPlugin.isLoaded())return L.tileLayer.chinaProvider(b,a.options)}},ags:{mustHaveUrl:!0,createLayer:function(a){if(Helpers.AGSLayerPlugin.isLoaded()){var b=angular.copy(a.options);angular.extend(b,{url:a.url});var c=new lvector.AGS(b);return c.onAdd=function(a){this.setMap(a)},c.onRemove=function(){this.setMap(null)},c}}},dynamic:{mustHaveUrl:!0,createLayer:function(a){return Helpers.DynamicMapLayerPlugin.isLoaded()?L.esri.dynamicMapLayer(a.url,a.options):void 0}},markercluster:{mustHaveUrl:!1,createLayer:function(a){return Helpers.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(a.options):void $log.error("[AngularJS - Leaflet] The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(a){return Helpers.BingLayerPlugin.isLoaded()?new L.BingLayer(a.key,a.options):void 0}},heatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(a){if(Helpers.HeatMapLayerPlugin.isLoaded()){var b=new L.TileLayer.WebGLHeatMap(a.options);return isDefined(a.data)&&b.setData(a.data),b}}},yandex:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"map";if(Helpers.YandexLayerPlugin.isLoaded())return new L.Yandex(b,a.options)}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(a){return L.imageOverlay(a.url,a.bounds,a.options)}},custom:{createLayer:function(a){return a.layer instanceof L.Class?angular.copy(a.layer):void $log.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}},cartodb:{mustHaveUrl:!0,createLayer:function(a){return cartodb.createLayer(a.map,a.url)}}};return{createLayer:function(a){if(isValidLayerType(a)){if(!isString(a.name))return void $log.error("[AngularJS - Leaflet] A base layer must have a name");isObject(a.layerParams)||(a.layerParams={}),isObject(a.layerOptions)||(a.layerOptions={});for(var b in a.layerParams)a.layerOptions[b]=a.layerParams[b];var c={url:a.url,data:a.data,options:a.layerOptions,layer:a.layer,type:a.layerType,bounds:a.bounds,key:a.key,pluginOptions:a.pluginOptions,user:a.user};return layerTypes[a.type].createLayer(c)}}}}]),angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletMapDefaults",function(a,b,c,d){var e,f=c.isObject,g=c.isDefined,h=function(a,b,c){var e=d.getDefaults(c);if(!e.controls.layers.visible)return!1;var g=0;return f(a)&&(g+=Object.keys(a).length),f(b)&&(g+=Object.keys(b).length),g>1},i=function(a){var b=d.getDefaults(a),c={collapsed:b.controls.layers.collapsed,position:b.controls.layers.position};angular.extend(c,b.controls.layers.options);var e;return e=b.controls.layers&&g(b.controls.layers.control)?b.controls.layers.control.apply(this,[[],[],c]):new L.control.layers([],[],c)};return{layersControlMustBeVisible:h,updateLayersControl:function(a,b,c,d,f,j){var k,l=h(d,f,b);if(g(e)&&c){for(k in j.baselayers)e.removeLayer(j.baselayers[k]);for(k in j.overlays)e.removeLayer(j.overlays[k]);e.removeFrom(a)}if(l){e=i(b);for(k in d)g(j.baselayers[k])&&e.addBaseLayer(j.baselayers[k],d[k].name);for(k in f)g(j.overlays[k])&&e.addOverlay(j.overlays[k],f[k].name);e.addTo(a)}return l}}}]),angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var a=function(a,b){if(a.innerHTML="",b.error)a.innerHTML+='<div class="info-title alert alert-danger">'+b.error.message+"</div>";else for(var c=0;c<b.layers.length;c++){var d=b.layers[c];a.innerHTML+='<div class="info-title" data-layerid="'+d.layerId+'">'+d.layerName+"</div>";for(var e=0;e<d.legend.length;e++){var f=d.legend[e];a.innerHTML+='<div class="inline" data-layerid="'+d.layerId+'"><img src="data:'+f.contentType+";base64,"+f.imageData+'" /></div><div class="info-label" data-layerid="'+d.layerId+'">'+f.label+"</div>"}}},b=function(b,c){return function(){var d=L.DomUtil.create("div",c);return L.Browser.touch?L.DomEvent.on(d,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(d),L.DomEvent.on(d,"mousewheel",L.DomEvent.stopPropagation)),a(d,b),d}},c=function(a,b){return function(){for(var c=L.DomUtil.create("div",b),d=0;d<a.colors.length;d++)c.innerHTML+='<div class="outline"><i style="background:'+a.colors[d]+'"></i></div><div class="info-label">'+a.labels[d]+"</div>";return L.Browser.touch?L.DomEvent.on(c,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(c),L.DomEvent.on(c,"mousewheel",L.DomEvent.stopPropagation)),c}};return{getOnAddArcGISLegend:b,getOnAddArrayLegend:c,updateArcGISLegend:a}}),angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(a,b,c){function d(a){return a.filter(function(a){return k(a)}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function e(a){return new L.LatLng(a.lat,a.lng)}function f(a){return a.map(function(a){return d(a)})}function g(a,b){for(var c={},d=0;d<l.length;d++){var e=l[d];h(a[e])?c[e]=a[e]:h(b.path[e])&&(c[e]=b.path[e])}return c}var h=c.isDefined,i=c.isArray,j=c.isNumber,k=c.isValidPoint,l=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],m=function(a,b){for(var c={},d=0;d<l.length;d++){var e=l[d];h(b[e])&&(c[e]=b[e])}a.setStyle(b)},n=function(a){if(!i(a))return!1;for(var b=0;b<a.length;b++){var c=a[b];if(!k(c))return!1}return!0},o={polyline:{isValid:function(a){var b=a.latlngs;return n(b)},createPath:function(a){return new L.Polyline([],a)},setPath:function(a,b){a.setLatLngs(d(b.latlngs)),m(a,b)}},multiPolyline:{isValid:function(a){var b=a.latlngs;if(!i(b))return!1;for(var c in b){var d=b[c];if(!n(d))return!1}return!0},createPath:function(a){return new L.multiPolyline([[[0,0],[1,1]]],a)},setPath:function(a,b){a.setLatLngs(f(b.latlngs)),m(a,b)}},polygon:{isValid:function(a){var b=a.latlngs;return n(b)},createPath:function(a){return new L.Polygon([],a)},setPath:function(a,b){a.setLatLngs(d(b.latlngs)),m(a,b)}},multiPolygon:{isValid:function(a){var b=a.latlngs;if(!i(b))return!1;for(var c in b){var d=b[c];if(!n(d))return!1}return!0},createPath:function(a){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],a)},setPath:function(a,b){a.setLatLngs(f(b.latlngs)),m(a,b)}},rectangle:{isValid:function(a){var b=a.latlngs;if(!i(b)||2!==b.length)return!1;for(var c in b){var d=b[c];if(!k(d))return!1}return!0},createPath:function(a){return new L.Rectangle([[0,0],[1,1]],a)},setPath:function(a,b){a.setBounds(new L.LatLngBounds(d(b.latlngs))),m(a,b)}},circle:{isValid:function(a){var b=a.latlngs;return k(b)&&j(a.radius)},createPath:function(a){return new L.Circle([0,0],1,a)},setPath:function(a,b){a.setLatLng(e(b.latlngs)),h(b.radius)&&a.setRadius(b.radius),m(a,b)}},circleMarker:{isValid:function(a){var b=a.latlngs;return k(b)&&j(a.radius)},createPath:function(a){return new L.CircleMarker([0,0],a)},setPath:function(a,b){a.setLatLng(e(b.latlngs)),h(b.radius)&&a.setRadius(b.radius),m(a,b)}}},p=function(a){var b={};return a.latlngs&&(b.latlngs=a.latlngs),a.radius&&(b.radius=a.radius),b};return{setPathOptions:function(a,b,c){h(b)||(b="polyline"),o[b].setPath(a,c)},createPath:function(a,c,d){h(c.type)||(c.type="polyline");var e=g(c,d),f=p(c);return o[c.type].isValid(f)?o[c.type].createPath(e):void b.error("[AngularJS - Leaflet] Invalid data passed to the "+c.type+" path")}}}]),angular.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(a,b){function c(a){return angular.isDefined(a)&&angular.isDefined(a.southWest)&&angular.isDefined(a.northEast)&&angular.isNumber(a.southWest.lat)&&angular.isNumber(a.southWest.lng)&&angular.isNumber(a.northEast.lat)&&angular.isNumber(a.northEast.lng)}var d=b.isArray,e=b.isNumber;return{createLeafletBounds:function(a){return c(a)?L.latLngBounds([a.southWest.lat,a.southWest.lng],[a.northEast.lat,a.northEast.lng]):void 0},isValidBounds:c,createBoundsFromArray:function(b){return d(b)&&2===b.length&&d(b[0])&&d(b[1])&&2===b[0].length&&2===b[1].length&&e(b[0][0])&&e(b[0][1])&&e(b[1][0])&&e(b[1][1])?{northEast:{lat:b[0][0],lng:b[0][1]},southWest:{lat:b[1][0],lng:b[1][1]}}:void a.error("[AngularJS - Leaflet] The bounds array is not valid.")}}}]),angular.module("leaflet-directive").factory("leafletMarkersHelpers",["$rootScope","leafletHelpers","$log",function(a,b,c){var d=b.isDefined,e=b.MarkerClusterPlugin,f=b.AwesomeMarkersPlugin,g=b.MakiMarkersPlugin,h=b.safeApply,i=b,j=b.isString,k=b.isNumber,l=b.isObject,m={},n=function(a){if(d(a)&&d(a.type)&&"awesomeMarker"===a.type)return f.isLoaded()||c.error("[AngularJS - Leaflet] The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(a);if(d(a)&&d(a.type)&&"makiMarker"===a.type)return g.isLoaded()||c.error("[AngularJS - Leaflet] The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(a);if(d(a)&&d(a.type)&&"div"===a.type)return new L.divIcon(a);var b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";return d(a)?(d(a.iconUrl)||(a.iconUrl=b,a.shadowUrl=e),new L.Icon(a)):new L.Icon.Default({iconUrl:b,shadowUrl:e})},o=function(a){d(m[a])&&m.splice(a,1)},p=function(){m={}},q=function(a,b,c){if(a.closePopup(),d(c)&&d(c.overlays))for(var e in c.overlays)if((c.overlays[e]instanceof L.LayerGroup||c.overlays[e]instanceof L.FeatureGroup)&&c.overlays[e].hasLayer(a))return void c.overlays[e].removeLayer(a);if(d(m))for(var f in m)m[f].hasLayer(a)&&m[f].removeLayer(a);b.hasLayer(a)&&b.removeLayer(a)};return{resetMarkerGroup:o,resetMarkerGroups:p,deleteMarker:q,createMarker:function(a){if(!d(a))return void c.error("[AngularJS - Leaflet] The marker definition is not valid.");var b={icon:n(a.icon),title:d(a.title)?a.title:"",draggable:d(a.draggable)?a.draggable:!1,clickable:d(a.clickable)?a.clickable:!0,riseOnHover:d(a.riseOnHover)?a.riseOnHover:!1,zIndexOffset:d(a.zIndexOffset)?a.zIndexOffset:0,iconAngle:d(a.iconAngle)?a.iconAngle:0};for(var e in a)a.hasOwnProperty(e)&&!b.hasOwnProperty(e)&&(b[e]=a[e]);var f=new L.marker(a,b);return j(a.message)||f.unbindPopup(),f},addMarkerToGroup:function(a,b,f,g){return j(b)?e.isLoaded()?(d(m[b])||(m[b]=new L.MarkerClusterGroup(f),g.addLayer(m[b])),void m[b].addLayer(a)):void c.error("[AngularJS - Leaflet] The MarkerCluster plugin is not loaded."):void c.error("[AngularJS - Leaflet] The marker group you have specified is invalid.")},listenMarkerEvents:function(a,b,c){a.on("popupopen",function(){h(c,function(){b.focus=!0})}),a.on("popupclose",function(){h(c,function(){b.focus=!1})})},addMarkerWatcher:function(a,b,e,f,g){var h=e.$watch("markers."+b,function(b,e){if(!d(b))return q(a,g,f),void h();if(d(e)){if(!k(b.lat)||!k(b.lng))return c.warn("There are problems with lat-lng data, please verify your marker model"),void q(a,g,f);if(j(b.layer)||j(e.layer)&&(d(f.overlays[e.layer])&&f.overlays[e.layer].hasLayer(a)&&(f.overlays[e.layer].removeLayer(a),a.closePopup()),g.hasLayer(a)||g.addLayer(a)),j(b.layer)&&e.layer!==b.layer){if(j(e.layer)&&d(f.overlays[e.layer])&&f.overlays[e.layer].hasLayer(a)&&f.overlays[e.layer].removeLayer(a),a.closePopup(),g.hasLayer(a)&&g.removeLayer(a),!d(f.overlays[b.layer]))return void c.error("[AngularJS - Leaflet] You must use a name of an existing layer");var m=f.overlays[b.layer];if(!(m instanceof L.LayerGroup||m instanceof L.FeatureGroup))return void c.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group" or "featureGroup"');m.addLayer(a),g.hasLayer(a)&&b.focus===!0&&a.openPopup()}if(b.draggable!==!0&&e.draggable===!0&&d(a.dragging)&&a.dragging.disable(),b.draggable===!0&&e.draggable!==!0&&(a.dragging?a.dragging.enable():L.Handler.MarkerDrag&&(a.dragging=new L.Handler.MarkerDrag(a),a.options.draggable=!0,a.dragging.enable())),l(b.icon)||l(e.icon)&&(a.setIcon(n()),a.closePopup(),a.unbindPopup(),j(b.message)&&a.bindPopup(b.message,b.popupOptions)),l(b.icon)&&l(e.icon)&&!angular.equals(b.icon,e.icon)){var o=!1;a.dragging&&(o=a.dragging.enabled()),a.setIcon(n(b.icon)),o&&a.dragging.enable(),a.closePopup(),a.unbindPopup(),j(b.message)&&a.bindPopup(b.message,b.popupOptions)}!j(b.message)&&j(e.message)&&(a.closePopup(),a.unbindPopup()),i.LabelPlugin.isLoaded()&&d(b.label)&&d(b.label.message)&&!angular.equals(b.label.message,e.label.message)&&a.updateLabelContent(b.label.message),j(b.message)&&!j(e.message)&&(a.bindPopup(b.message,b.popupOptions),b.focus===!0&&a.openPopup()),j(b.message)&&j(e.message)&&b.message!==e.message&&a.setPopupContent(b.message);var p=!1;b.focus!==!0&&e.focus===!0&&(a.closePopup(),p=!0),b.focus===!0&&e.focus!==!0&&(a.openPopup(),p=!0),e.focus===!0&&b.focus===!0&&(a.openPopup(),p=!0),e.zIndexOffset!==b.zIndexOffset&&a.setZIndexOffset(b.zIndexOffset);var r=a.getLatLng(),s=j(b.layer)&&i.MarkerClusterPlugin.is(f.overlays[b.layer]);s?p?(b.lat!==e.lat||b.lng!==e.lng)&&(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):r.lat!==b.lat||r.lng!==b.lng?(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):(b.lat!==e.lat||b.lng!==e.lng)&&(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):(r.lat!==b.lat||r.lng!==b.lng)&&a.setLatLng([b.lat,b.lng])}},!0)}}}]),angular.module("leaflet-directive").factory("leafletHelpers",["$q","$log",function(a,b){function c(a,c){var d,e;if(angular.isDefined(c))d=c;else if(0===Object.keys(a).length)d="main";else if(Object.keys(a).length>=1)for(e in a)a.hasOwnProperty(e)&&(d=e);else 0===Object.keys(a).length?d="main":b.error("[AngularJS - Leaflet] - You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return d}function d(b,d){var e,f=c(b,d);return angular.isDefined(b[f])&&b[f].resolvedDefer!==!0?e=b[f].defer:(e=a.defer(),b[f]={defer:e,resolvedDefer:!1}),e}return{isEmpty:function(a){return 0===Object.keys(a).length},isUndefinedOrEmpty:function(a){return angular.isUndefined(a)||null===a||0===Object.keys(a).length},isDefined:function(a){return angular.isDefined(a)&&null!==a},isNumber:function(a){return angular.isNumber(a)},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},isFunction:function(a){return angular.isFunction(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)&&angular.isNumber(a.zoom)},isValidPoint:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)},isSameCenterOnMap:function(a,b){var c=b.getCenter(),d=b.getZoom();return a.lat&&a.lng&&c.lat.toFixed(4)===a.lat.toFixed(4)&&c.lng.toFixed(4)===a.lng.toFixed(4)&&d===a.zoom?!0:!1},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},obtainEffectiveMapId:c,getDefer:function(a,b){var e,f=c(a,b);return e=angular.isDefined(a[f])&&a[f].resolvedDefer!==!1?a[f].defer:d(a,b)},getUnresolvedDefer:d,setResolvedDefer:function(a,b){var d=c(a,b);a[d].resolvedDefer=!0},AwesomeMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return angular.isDefined(L.PolylineDecorator)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.PolylineDecorator:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},MakiMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.MakiMarkers.Icon:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(a){return this.isLoaded()?a instanceof L.GeoJSON.WFS:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(a){return this.isLoaded()?a instanceof lvector.AGS:!1}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(a){return this.isLoaded()?a instanceof L.Yandex:!1}},DynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(a){return this.isLoaded()?a instanceof L.esri.dynamicMapLayer:!1}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(a){return this.isLoaded()?a instanceof L.TileLayer.GeoJSON:!1}},UTFGridPlugin:{isLoaded:function(){return angular.isDefined(L.UtfGrid)},is:function(a){return this.isLoaded()?a instanceof L.UtfGrid:(b.error("[AngularJS - Leaflet] No UtfGrid plugin found."),!1)}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return!0}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)?angular.equals(a,b):!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)?angular.equals(a,b):!1}}}}}])}(),!function(a,b){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,
singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.addLayers(b)}if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this;if(!this._map)return this._needsClustering.push(a),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom);var d=a,e=this._map.getZoom();if(a.__parent)for(;d.__parent._zoom>=e;)d=d.__parent;return this._currentShownBounds.contains(d.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,d):this._animationAddLayerNonAnimated(a,d)),this},removeLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.removeLayers(b)}return a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.setOpacity&&a.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push(a),this):(this._nonPointGroup.removeLayer(a),this)},addLayers:function(a){var b,c,d,e,f=this._featureGroup,g=this._nonPointGroup,h=this.options.chunkedLoading,i=this.options.chunkInterval,j=this.options.chunkProgress;if(this._map){var k=0,l=(new Date).getTime(),m=L.bind(function(){for(var b=(new Date).getTime();k<a.length;k++){if(h&&0===k%200){var c=(new Date).getTime()-b;if(c>i)break}if(e=a[k],e.getLatLng){if(!this.hasLayer(e)&&(this._addLayer(e,this._maxZoom),e.__parent&&2===e.__parent.getChildCount())){var d=e.__parent.getAllChildMarkers(),n=d[0]===e?d[1]:d[0];f.removeLayer(n)}}else g.addLayer(e)}j&&j(k,a.length,(new Date).getTime()-l),k===a.length?(this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else{for(b=[],c=0,d=a.length;d>c;c++)e=a[c],e.getLatLng?this.hasLayer(e)||b.push(e):g.addLayer(e);this._needsClustering=this._needsClustering.concat(b)}return this},removeLayers:function(a){var b,c,d,e=this._featureGroup,f=this._nonPointGroup;if(!this._map){for(b=0,c=a.length;c>b;b++)d=a[b],this._arraySplice(this._needsClustering,d),f.removeLayer(d);return this}for(b=0,c=a.length;c>b;b++)d=a[b],d.__parent?(this._removeLayer(d,!0,!0),e.hasLayer(d)&&(e.removeLayer(d),d.setOpacity&&d.setOpacity(1))):f.removeLayer(d);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),e.eachLayer(function(a){a instanceof L.MarkerCluster&&a._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){delete a.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(var b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(d),c=d.length-1;c>=0;c--)a.call(b,d[c]);this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!0;for(c=this._needsRemoving,b=c.length-1;b>=0;b--)if(c[b]===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){var c=function(){if((a._icon||a.__parent._icon)&&!this._inZoomAnimation)if(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon)b();else if(a.__parent._icon){var d=function(){this.off("spiderfied",d,this),b()};this.on("spiderfied",d,this),a.__parent.spiderfy()}};if(a._icon&&this._map.getBounds().contains(a.getLatLng()))b();else if(a.__parent._zoom<this._map.getZoom())this._map.on("moveend",c,this),this._map.panTo(a.getLatLng());else{var d=function(){this._map.off("movestart",d,this),d=null};this._map.on("movestart",d,this),this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds(),d&&c.call(this)}},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(a),this._nonPointGroup.onAdd(a),this._gridClusters||this._generateInitialClusters(),b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],this._removeLayer(d,!0);this._needsRemoving=[],this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),c=this._needsClustering,this._needsClustering=[],this.addLayers(c)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(a),this._nonPointGroup.onRemove(a),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){for(var b=a;b&&!b._icon;)b=b.__parent;return b||null},_arraySplice:function(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b)return a.splice(c,1),!0},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map;if(b)for(var h=this._maxZoom;h>=0&&e[h].removeObject(a,g.project(a.getLatLng(),h));h--);var i,j=a.__parent,k=j._markers;for(this._arraySplice(k,a);j&&(j._childCount--,!(j._zoom<0));)b&&j._childCount<=1?(i=j._markers[0]===a?j._markers[1]:j._markers[0],d[j._zoom].removeObject(j,g.project(j._cLatLng,j._zoom)),e[j._zoom].addObject(i,g.project(i.getLatLng(),j._zoom)),this._arraySplice(j.__parent._childClusters,j),j.__parent._markers.push(i),i.__parent=j.__parent,j._icon&&(f.removeLayer(j),c||f.addLayer(i))):(j._recalculateBounds(),c&&j._icon||j._updateIcon()),j=j.__parent;delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},_propagateEvent:function(a){if(a.layer instanceof L.MarkerCluster){if(a.originalEvent&&this._isOrIsParent(a.layer._icon,a.originalEvent.relatedTarget))return;a.type="cluster"+a.type}this.fire(a.type,a)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=10>b?"small":100>b?"medium":"large",new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){var b=this._map;b.getMaxZoom()===b.getZoom()?this.options.spiderfyOnMaxZoom&&a.layer.spiderfy():this.options.zoomToBoundsOnClick&&a.layer.zoomToBounds(),a.originalEvent&&13===a.originalEvent.keyCode&&b._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,a),this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius,c=b;"function"!=typeof b&&(c=function(){return b}),this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var d=a;d>=0;d--)this._gridClusters[d]=new L.DistanceGrid(c(d)),this._gridUnclustered[d]=new L.DistanceGrid(c(d));this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(a,b){var c,d,e=this._gridClusters,f=this._gridUnclustered;for(this.options.singleMarkerMode&&(a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}}));b>=0;b--){c=this._map.project(a.getLatLng(),b);var g=e[b].getNearObject(c);if(g)return g._addChild(a),void(a.__parent=g);if(g=f[b].getNearObject(c)){var h=g.__parent;h&&this._removeLayer(g,!1);var i=new L.MarkerCluster(this,b,g,a);e[b].addObject(i,this._map.project(i._cLatLng,b)),g.__parent=i,a.__parent=i;var j=i;for(d=b-1;d>h._zoom;d--)j=new L.MarkerCluster(this,d,j),e[d].addObject(j,this._map.project(g.getLatLng(),d));for(h._addChild(j),d=b;d>=0&&f[d].removeObject(g,this._map.project(g.getLatLng(),d));d--);return}f[b].addObject(a,c)}this._topClusterLevel._addChild(a),a.__parent=this._topClusterLevel},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var a=this._map,b=a.getBounds(),c=b._southWest,d=b._northEast,e=L.Browser.mobile?0:Math.abs(c.lat-d.lat),f=L.Browser.mobile?0:Math.abs(c.lng-d.lng);return new L.LatLngBounds(new L.LatLng(c.lat-e,c.lng-f,!0),new L.LatLng(d.lat+e,d.lng+f,!0))},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(a,b){var c,d=this._getExpandedVisibleBounds(),e=this._featureGroup;this._topClusterLevel._recursively(d,a,0,function(f){var g,h=f._latlng,i=f._markers;for(d.contains(h)||(h=null),f._isSingleParent()&&a+1===b?(e.removeLayer(f),f._recursivelyAddChildrenToMap(null,b,d)):(f.setOpacity(0),f._recursivelyAddChildrenToMap(h,b,d)),c=i.length-1;c>=0;c--)g=i[c],d.contains(g._latlng)||e.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(d,b),e.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.setOpacity(1)}),this._topClusterLevel._recursively(d,a,b,function(a){a._recursivelyRestoreChildPositions(b)}),this._enqueue(function(){this._topClusterLevel._recursively(d,a,0,function(a){e.removeLayer(a),a.setOpacity(1)}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(d,b+1,c);var e=this;this._forceLayout(),a._recursivelyBecomeVisible(d,c),this._enqueue(function(){if(1===a._childCount){var f=a._markers[0];f.setLatLng(f.getLatLng()),f.setOpacity&&f.setOpacity(1)}else a._recursively(d,c,0,function(a){a._recursivelyRemoveChildrenFromMap(d,b+1)});e._animationEnd()})},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.setOpacity(0),this._enqueue(function(){d.removeLayer(a),a.setOpacity(1),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(b.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;b>=0;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;c>=0;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var a,b=this._childClusters.slice(),c=this._group._map,d=c.getBoundsZoom(this._bounds),e=this._zoom+1,f=c.getZoom();b.length>0&&d>e;){e++;var g=[];for(a=0;a<b.length;a++)g=g.concat(b[a]._childClusters);b=g}d>e?this._group._map.setView(this._latlng,e):f>=d?this._group._map.setView(this._latlng,f+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._expandBounds(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_expandBounds:function(a){var b,c=a._wLatLng||a._latlng;a instanceof L.MarkerCluster?(this._bounds.extend(a._bounds),b=a._childCount):(this._bounds.extend(c),b=1),this._cLatLng||(this._cLatLng=a._cLatLng||c);var d=this._childCount+b;this._wLatLng?(this._wLatLng.lat=(c.lat*b+this._wLatLng.lat*this._childCount)/d,this._wLatLng.lng=(c.lng*b+this._wLatLng.lng*this._childCount)/d):this._latlng=this._wLatLng=new L.LatLng(c.lat,c.lng)},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var c,d,e=a._markers;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.setOpacity(0))},function(a){var c,d,e=a._childClusters;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(d){d._recursivelyAnimateChildrenIn(a,d._group._map.latLngToLayerPoint(d.getLatLng()).round(),b),d._isSingleParent()&&b-1===c?(d.setOpacity(1),d._recursivelyRemoveChildrenFromMap(a,b)):d.setOpacity(0),d._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.setOpacity(1)})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;e>=0;e--){var f=d._markers[e];c.contains(f._latlng)&&(a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.setOpacity&&f.setOpacity(0)),d._group._featureGroup.addLayer(f))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;b>=0;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var d,e;this._recursively(a,-1,b-1,function(a){for(e=a._markers.length-1;e>=0;e--)d=a._markers[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1))},function(a){for(e=a._childClusters.length-1;e>=0;e--)d=a._childClusters[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1))})},_recursively:function(a,b,c,d,e){var f,g,h=this._childClusters,i=this._zoom;if(b>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e);else if(d&&d(this),e&&this._zoom===c&&e(this),c>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e)},_recalculateBounds:function(){var a,b=this._markers,c=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,a=b.length-1;a>=0;a--)this._expandBounds(b[a]);for(a=c.length-1;a>=0;a--)this._expandBounds(c[a])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(a);this._objectPoint[h]=b,g.push(a)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(a,b){var c,d,e=this._getCoord(b.x),f=this._getCoord(b.y),g=this._grid,h=g[f]=g[f]||{},i=h[e]=h[e]||[];for(delete this._objectPoint[L.Util.stamp(a)],c=0,d=i.length;d>c;c++)if(i[c]===a)return i.splice(c,1),1===d&&delete h[e],!0},eachObject:function(a,b){var c,d,e,f,g,h,i,j=this._grid;for(c in j){g=j[c];for(d in g)for(h=g[d],e=0,f=h.length;f>e;e++)i=a.call(b,h[e]),i&&(e--,f--)}},getNearObject:function(a){var b,c,d,e,f,g,h,i,j=this._getCoord(a.x),k=this._getCoord(a.y),l=this._objectPoint,m=this._sqCellSize,n=null;for(b=k-1;k+1>=b;b++)if(e=this._grid[b])for(c=j-1;j+1>=c;c++)if(f=e[c])for(d=0,g=f.length;g>d;d++)h=f[d],i=this._sqDist(l[L.Util.stamp(h)],a),m>i&&(m=i,n=h);return n},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat,d=b[0].lng-b[1].lng;return d*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c,d,e,f=0,g=null,h=[];for(c=b.length-1;c>=0;c--)d=b[c],e=this.getDistant(d,a),e>0&&(h.push(d),e>f&&(f=e,g=d));return{maxPoint:g,newPoints:h}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);return d.maxPoint?(c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints))):[a[0]]},getConvexHull:function(a){var b,c=!1,d=!1,e=null,f=null;for(b=a.length-1;b>=0;b--){var g=a[b];(c===!1||g.lat>c)&&(e=g,c=g.lat),(d===!1||g.lat<d)&&(f=g,d=g.lat)}var h=[].concat(this.buildConvexHull([f,e],a),this.buildConvexHull([e,f],a));return h}}}(),L.MarkerCluster.include({getConvexHull:function(){var a,b,c=this.getAllChildMarkers(),d=[];for(b=c.length-1;b>=0;b--)a=c[b].getLatLng(),d.push(a);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(),c=this._group,d=c._map,e=d.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,e):(e.y+=10,a=this._generatePointsCircle(b.length,e)),this._animationSpiderfy(b,a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c,d,e=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a),f=e/this._2PI,g=this._2PI/a,h=[];for(h.length=a,c=a-1;c>=0;c--)d=this._circleStartAngle+c*g,h[c]=new L.Point(b.x+f*Math.cos(d),b.y+f*Math.sin(d))._round();return h},_generatePointsSpiral:function(a,b){var c,d=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,e=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,f=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,g=0,h=[];for(h.length=a,c=a-1;c>=0;c--)g+=e/d+5e-4*c,h[c]=new L.Point(b.x+d*Math.cos(g),b.y+d*Math.sin(g))._round(),d+=this._2PI*f/g;return h},_noanimationUnspiderfy:function(){var a,b,c=this._group,d=c._map,e=c._featureGroup,f=this.getAllChildMarkers();for(this.setOpacity(1),b=f.length-1;b>=0;b--)a=f[b],e.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(d.removeLayer(a._spiderLeg),delete a._spiderLeg);c._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return b.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(a,c){var d,e,f,g,h=this,i=this._group,j=i._map,k=i._featureGroup,l=j.latLngToLayerPoint(this._latlng);for(d=a.length-1;d>=0;d--)e=a[d],e.setOpacity?(e.setZIndexOffset(1e6),e.setOpacity(0),k.addLayer(e),e._setPos(l)):k.addLayer(e);i._forceLayout(),i._animationStart();var m=L.Path.SVG?0:.3,n=L.Path.SVG_NS;for(d=a.length-1;d>=0;d--)if(g=j.layerPointToLatLng(c[d]),e=a[d],e._preSpiderfyLatlng=e._latlng,e.setLatLng(g),e.setOpacity&&e.setOpacity(1),f=new L.Polyline([h._latlng,g],{weight:1.5,color:"#222",opacity:m}),j.addLayer(f),e._spiderLeg=f,L.Path.SVG&&this.SVG_ANIMATION){var o=f._path.getTotalLength();f._path.setAttribute("stroke-dasharray",o+","+o);var p=b.createElementNS(n,"animate");p.setAttribute("attributeName","stroke-dashoffset"),p.setAttribute("begin","indefinite"),p.setAttribute("from",o),p.setAttribute("to",0),p.setAttribute("dur",.25),f._path.appendChild(p),p.beginElement(),p=b.createElementNS(n,"animate"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("begin","indefinite"),p.setAttribute("from",0),p.setAttribute("to",.5),p.setAttribute("dur",.25),f._path.appendChild(p),p.beginElement()}if(h.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),d=a.length-1;d>=0;d--)e=a[d]._spiderLeg,e.options.opacity=.5,e._path.setAttribute("stroke-opacity",.5);setTimeout(function(){i._animationEnd(),i.fire("spiderfied")},200)},_animationUnspiderfy:function(a){var b,c,d,e=this._group,f=e._map,g=e._featureGroup,h=a?f._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):f.latLngToLayerPoint(this._latlng),i=this.getAllChildMarkers(),j=L.Path.SVG&&this.SVG_ANIMATION;for(e._animationStart(),this.setOpacity(1),c=i.length-1;c>=0;c--)b=i[c],b._preSpiderfyLatlng&&(b.setLatLng(b._preSpiderfyLatlng),delete b._preSpiderfyLatlng,b.setOpacity?(b._setPos(h),b.setOpacity(0)):g.removeLayer(b),j&&(d=b._spiderLeg._path.childNodes[0],d.setAttribute("to",d.getAttribute("from")),d.setAttribute("from",0),d.beginElement(),d=b._spiderLeg._path.childNodes[1],d.setAttribute("from",.5),d.setAttribute("to",0),d.setAttribute("stroke-opacity",0),d.beginElement(),b._spiderLeg._path.setAttribute("stroke-opacity",0)));setTimeout(function(){var a=0;for(c=i.length-1;c>=0;c--)b=i[c],b._spiderLeg&&a++;for(c=i.length-1;c>=0;c--)b=i[c],b._spiderLeg&&(b.setOpacity&&(b.setOpacity(1),b.setZIndexOffset(0)),a>1&&g.removeLayer(b),f.removeLayer(b._spiderLeg),delete b._spiderLeg);e._animationEnd()},200)}}:{_animationSpiderfy:function(a,b){var c,d,e,f,g=this._group,h=g._map,i=g._featureGroup;for(c=a.length-1;c>=0;c--)f=h.layerPointToLatLng(b[c]),d=a[c],d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset&&d.setZIndexOffset(1e6),i.addLayer(d),e=new L.Polyline([this._latlng,f],{weight:1.5,color:"#222"}),h.addLayer(e),d._spiderLeg=e;this.setOpacity(.3),g.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.setOpacity(1),a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}})}(window,document),L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(a,b){L.Util.setOptions(this,b),this._ready=void 0!=google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=a||"SATELLITE"},onAdd:function(a,b){this._map=a,this._insertAtTheBottom=b,this._initContainer(),this._initMapObject(),a.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),a.on("move",this._update,this),a.on("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(a){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),this._map.off("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(a){this.options.opacity=a,1>a&&L.DomUtil.setOpacity(this._container,a)},setElementSize:function(a,b){a.style.width=b.x+"px",a.style.height=b.y+"px"},_initContainer:function(){var a=this._map._container,b=a.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),a.insertBefore(this._container,b),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var a=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),b=this;this._reposition=google.maps.event.addListenerOnce(a,"center_changed",function(){b.onReposition()}),this._google=a,google.maps.event.addListenerOnce(a,"idle",function(){b._checkZoomLevels()})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(a){this._reset(a.hard)},_reset:function(a){this._initContainer()},_update:function(a){if(this._google){this._resize();var b=a&&a.latlng?a.latlng:this._map.getCenter(),c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(this._map.getZoom()),this._checkZoomLevels()}},_resize:function(){var a=this._map.getSize();(this._container.style.width!=a.x||this._container.style.height!=a.y)&&(this.setElementSize(this._container,a),this.onReposition())},_handleZoomAnim:function(a){var b=a.center,c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(a.zoom)},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var a;for(a=0;a<L.Google.asyncWait.length;a++){var b=L.Google.asyncWait[a];b._ready=!0,b._container&&(b._initMapObject(),b._update())}L.Google.asyncWait=[]};var gfsad={};gfsad.decToHex=function(a){if(a>255)throw"Cannot convert to hex.";return(a+256).toString(16).substr(-2).toUpperCase()};var app=angular.module("app",["leaflet-directive","ngRoute","mgcrea.ngStrap","server"]);app.config(["$tooltipProvider","$routeProvider","$sceDelegateProvider","$locationProvider","server.config",function(a,b,c,d,e){
e.cdn;b.when("/app/map",{templateUrl:"/static/templates/map.html",controller:"MapController",reloadOnSearch:!1}).when("/app/data",{templateUrl:"/static/templates/data.html",controller:"DataController"}).when("/app/data/search",{templateUrl:"/static/templates/data/search.html",controller:"DataSearchController",reloadOnSearch:!1}).when("/app/data/record",{templateUrl:"/static/templates/data/record.html",controller:"DataRecordController"}).when("/app/data/classify",{templateUrl:"/static/templates/data/classify.html",controller:"ClassifyController"}).when("/app/a/login",{templateUrl:"/static/templates/account/login.html",controller:"LoginController"}).when("/app/a/register",{templateUrl:"/static/templates/account/register.html",controller:"RegisterController"}).when("/app/a/forgot",{templateUrl:"/static/templates/account/forgot.html",controller:"ForgotController"}).when("/app/a/reset",{templateUrl:"/static/templates/account/reset.html",controller:"ResetController"}).when("/app/a/logout",{templateUrl:"/static/templates/account/logout.html",controller:"LogoutController"}).otherwise({templateUrl:"/static/templates/404.html"}),d.html5Mode(!0),angular.extend(a.defaults,{animation:"am-fade-and-scale",trigger:"hover",placement:"bottom",container:"body"}),c.resourceUrlWhitelist(["self","http://127.0.0.1:8000/**","https://api.croplands.org/**"])}]),app.factory("DataRecord",["mappings","$http","$rootScope","$q","DataService","log","User","$location",function(a,b,c,d,e,f,g,h){var i="https://api.croplands.org",j={paging:{},current:{}};return j.paging.hasNext=function(){return e.records.length>j.index+1},j.paging.hasPrevious=function(){return j.index>0},j.paging.next=function(){return j.paging.hasNext()&&j.goTo(++j.index),j.index},j.paging.previous=function(){j.paging.hasPrevious()&&j.goTo(--j.index)},j.get=function(a){var c=d.defer();return b({method:"GET",url:i+"/api/records/"+String(a)}).then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise},j.goTo=function(a){void 0!==a&&(j.index=a),j.current=e.records[a],h.path("/app/data/record").search({id:j.current.id})},j}]),app.factory("DataService",["mappings","$http","$rootScope","$q","$timeout","log","User","$window","$httpParamSerializer",function(a,b,c,d,e,f,g,h,i){function j(a,b){_.each(a,function(a){a.selected=b})}function k(a,b){var c,d=a.split("\n"),e=d[0].split(",");return c=_.map(d.slice(1,d.length-1),function(a){var c={};return _.each(a.split(","),function(a,d){var f=a;b&&b[e[d]]&&(f=b[e[d]](a)),c[e[d]]=f}),c})}var l="https://api.croplands.org",m={records:[],count:{},columns:angular.copy(a),ordering:{},paging:{page:1,page_size:200},busy:!1,bounds:!1,ndviLimits:!1,is_initialized:!1},n=d.defer();return m.getParams=function(){var a={};return _.each(m.columns,function(b,c){var d=[];_.each(b.choices,function(a){a.selected&&d.push(a.id)}),a[c]=d}),m.bounds&&(a.southWestBounds=m.bounds.southWest.lat+","+m.bounds.southWest.lng,a.northEastBounds=m.bounds.northEast.lat+","+m.bounds.northEast.lng),m.ndviLimits&&(a.ndvi_limit_upper=m.ndviLimits.upper.join(","),a.ndvi_limit_lower=m.ndviLimits.lower.join(",")),_.assign(a,m.ordering,m.paging)},m.setDefault=function(){j(m.columns.land_use_type.choices,!1),j(m.columns.crop_primary.choices,!1),j(m.columns.water.choices,!1),j(m.columns.intensity.choices,!1),j(m.columns.year.choices,!1),j(m.columns.source_type.choices,!1)},m.reset=function(){f.info("[DataService] Reset"),m.setDefault()},m.load=function(){f.info("[DataService] Load");var a=d.defer();return m.busy=!0,m.is_initialized=!0,n.resolve(),n=d.defer(),b({url:l+"/data/search",method:"GET",params:m.getParams(),timeout:n.promise}).then(function(b){m.records=k(b.data,{id:parseInt,month:parseInt,year:parseInt,lat:parseFloat,lon:parseFloat,crop_primary:parseInt,crop_secondary:parseInt,water:parseInt,intensity:parseInt,land_use_type:parseInt});var d=b.headers();m.count.total=d["query-count-total"],m.count.filtered=d["query-count-filtered"],a.resolve(b),c.$broadcast("DataService.load",m.records),m.busy=!1},function(b){a.reject(b)}),a.promise},m.download=function(){var a,b,c=m.getParams();c.page_size=1e5,a=i(c),b=l+"/data/download?"+a,h.open(b)},m.init=function(){f.info("[DataService] Init"),m.is_initialized||(m.setDefault(),m.load(),m.is_initialized=!0)},m}]),app.factory("RatingService",["$http","$rootScope","log","User","$q","locationFactory",function(a,b,c,d,e,f){function g(b,d){var g=e.defer();return a({method:"POST",url:j+"/api/ratings",data:{record_id:b.id,rating:d}}).then(function(a){b.user_rating=a.data,b.visited=!0,f.setIcon(b),c.debug("[RatingService] Set the rating to: "+String(d)),g.resolve(b)},function(a){c.error("[RatingService] Could not set rating."),g.reject(a)}),g.promise}function h(){c.info("[RatingService] Getting Ratings for Records");var b,g=e.defer();return d.isLoggedIn()&&d.get().id?(b=d.get().id,a({method:"GET",url:j+'/api/ratings?q={"filters":[{"name":"user_id","op":"eq","val":'+b+"}]}"}).then(function(a){c.info(a),_.each(a.data.objects,function(a){i[a.record_id]=a}),_.each(f.getRecords(),function(a){i[a.id]&&(a.user_rating=i[a.id],f.setIcon(a))}),g.resolve()},function(a){c.error(a),g.reject(a)})):g.reject(),g.promise}var i={},j="https://api.croplands.org";return b.$on("locationFactory.markers.downloaded",function(){h()}),{rateRecord:g,getRecordRatings:h}}]),app.factory("User",["$http","$window","$q","log","$rootScope","$location",function(a,b,c,d,e,f){function g(){return t}function h(){var a;return a=t.role?t.role:"anon"}function i(c){t=JSON.parse(b.atob(c.split(".")[1])),t.token=c,b.localStorage.user=JSON.stringify(t),a.defaults.headers.common.authorization="bearer "+t.token}function j(){if(t.expires&&t.token){var a=t.expires-Math.floor((new Date).getTime()/1e3);return a>300}return!1}function k(){var a;try{a=JSON.parse(window.atob(decodeURIComponent(f.search().n))),f.path(a.path).search(a.params)}catch(c){b.location.href="/"}}function l(b,d){var e=c.defer();return a.post("https://api.croplands.org/auth/reset",{token:b,password:d}).then(function(){e.resolve(!0)},function(){e.resolve(!1)}),e.promise}function m(b,f){d.info("[User] Logging in...");var g=c.defer(),h={email:b,password:f},j={"Content-Type":"application/json"};return a.post(u+"/auth/login",h,j).then(function(a){d.info("[User] Successfully logged in."),a.data.data.token&&i(a.data.data.token),g.resolve(a.data),e.$emit("User.change")},function(a){a.data?g.reject(a.data):g.reject()}),g.promise}function n(b){var f=c.defer(),g={Accept:"application/json","Content-Type":"application/json"};return a.post(u+"/auth/register",b,g).then(function(a){d.info("[User] Successfully registered."),a.data.data.token&&i(a.data.data.token),f.resolve(a.data),e.$emit("User.change")},function(a){a.data?f.reject(a.data):f.reject(a)}),f.promise}function o(b){var e={email:b},f=c.defer(),g={Accept:"application/json","Content-Type":"application/json"};return a.post(u+"/auth/forgot",e,g).then(function(a){d.info("[User] Sending reset email."),f.resolve(a.data)},function(a){a.data?f.reject(a.data):f.reject()}),f.promise}function p(b,e){var f={password:b,token:e},g=c.defer(),h={Accept:"application/json","Content-Type":"application/json"};return a.post(u+"/auth/reset",f,h).then(function(a){d.info("[User] Changing password."),a.data.data.token&&i(a.data.data.token),g.resolve(a.data)},function(a){a.data?g.reject(a.data):g.reject()}),g.promise}function q(){d.info("[User] Removing user token."),b.localStorage.user&&b.localStorage.removeItem("user"),t={},delete a.defaults.headers.common.authorization,delete a.defaults.headers.post.authorization,delete a.defaults.headers.put.authorization,delete a.defaults.headers.patch.authorization,e.$emit("User.change")}function r(){var a=JSON.parse(b.localStorage.user);i(a.token),e.$emit("User.change")}function s(){d.info("Checking for existence of user token."),b.localStorage.user&&r(),angular.element(b).on("storage",function(){b.localStorage.user?r():t={}})}var t={},u="https://api.croplands.org";return s(),{changePassword:l,getRole:h,isLoggedIn:j,login:m,logout:q,register:n,forgot:o,reset:p,get:g,goNext:k}}]),app.constant("countries",["Afghanistan","Aland Islands","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antarctica","Antigua And Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia, Plurinational State of","Bonaire, Sint Eustatius and Saba","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Indian Ocean Territory","Brunei Darussalam","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo","Congo, the Democratic Republic of the","Cook Islands","Costa Rica","Cote d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Falkland Islands (Malvinas)","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Holy See (Vatican City State)","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran, Islamic Republic of","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Korea, Democratic People's Republic of","Korea, Republic of","Kuwait","Kyrgyzstan","Lao People's Democratic Republic","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Macedonia, The Former Yugoslav Republic Of","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia, Federated States of","Moldova, Republic of","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","Northern Mariana Islands","Norway","Oman","Pakistan","Palau","Palestinian Territory, Occupied","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russian Federation","Rwanda","Saint Barthelemy","Saint Helena, Ascension and Tristan da Cunha","Saint Kitts and Nevis","Saint Lucia","Saint Martin (French Part)","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Sint Maarten (Dutch Part)","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Svalbard and Jan Mayen","Swaziland","Sweden","Switzerland","Syrian Arab Republic","Taiwan, Province of China","Tajikistan","Tanzania, United Republic of","Thailand","Timor-Leste","Togo","Tokelau","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Turks and Caicos Islands","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","United States Minor Outlying Islands","Uruguay","Uzbekistan","Vanuatu","Venezuela, Bolivarian Republic of","Viet Nam","Virgin Islands, British","Virgin Islands, U.S.","Wallis and Futuna","Western Sahara","Yemen","Zambia","Zimbabwe"]),app.factory("geoHelperService",[function(){function a(a,b,c){var d,e,f,g,h=6378.1;return 10>=c||-1===b?[a.lat,a.lng]:(d=a[0]*(Math.PI/180),e=a[1]*(Math.PI/180),b*=Math.PI/180,f=Math.asin(Math.sin(d)*Math.cos(c/h)+Math.cos(d)*Math.sin(c/h)*Math.cos(b)),g=e+Math.atan2(Math.sin(b)*Math.sin(c/h)*Math.cos(d),Math.cos(c/h)-Math.sin(d)*Math.sin(f)),[f*(180/Math.PI),g*(180/Math.PI)])}return{destination:a}}]),app.service("log",["$log","$timeout",function(a,b){var c=[],d="[GFSAD] ",e=function(a){c.push({date:Date.now(),message:a})};this.info=function(f,g){a.info(d+f),g&&(e(f),b(function(){c=c.slice(1)},1e4))},this.warn=function(f,g){a.warn(d+f),g&&(e(f),b(function(){c=c.slice(1)},1e4))},this.error=function(f,g){a.error(d+f),g&&(e(f),b(function(){c=c.slice(1)},1e4))},this.debug=function(b){a.debug(d+b)},this.getLog=function(){return c}}]),app.factory("mapService",["wmsLayers","leafletData","$http","$q","$interval","$timeout",function(a,b,c,d,e,f){var g={allowedEvents:{map:{enable:["moveend","click"],logic:"emit"},marker:{enable:["click"],logic:"emit"}},bounds:{northEast:{lat:90,lng:180},southWest:{lat:-90,lng:-180}},center:{lat:0,lng:0,zoom:2},layers:{baselayers:{googleHybrid:{name:"Satellite",layerType:"HYBRID",type:"google",visible:!0},googleTerrain:{name:"Terrain",layerType:"TERRAIN",type:"google",visible:!1},googleRoadmap:{name:"Streets",layerType:"ROADMAP",type:"google",visible:!1},ndvi_landsat_7_2014:{layerOptions:{opacity:1,minZoom:0,maxNativeZoom:15,zIndex:0},visible:!1,name:"NDVI Landsat 7 2014 Composite",type:"xyz",url:"http://tiles.croplands.org/ndvi_landsat_7_2014/{x}/{y}/{z}"}},overlays:{gfsad1000v00:a.gfsad1000v00,gfsad1000v10:a.gfsad1000v10,us250v201512y2008:a.us250v201512y2008,africaL4250v201512y2014:a.africaL4250v201512y2014,egypt30mv201512y2014:a.egypt30mv201512y2014,southamerica30v201512:a.southamerica30v201512,southAsia250v201601y2010:a.southAsia250v201601y2010,australia:a.australiaACCA250m}}};return g.zoom=function(a,b,c){c&&(g.center.zoom=c),g.center.lat=a,g.center.lng=b},g.zoomIn=function(){this.center.zoom+=1},g.zoomOut=function(){this.center.zoom-=1},g}]),app.factory("mappings",[function(){var a={land_use_type:{label:"Land Use Type",style:"primary",choices:[{id:0,order:8,label:"Unknown",description:"Not cropland is..."},{id:1,order:1,label:"Cropland",description:"Cropland is..."},{id:2,order:4,label:"Forest",description:"Forest is ..."},{id:3,order:3,label:"Grassland",description:"Grassland is ..."},{id:4,order:2,label:"Barren",description:"Barrenland is ..."},{id:5,order:6,label:"Builtup",description:"Urban is ..."},{id:6,order:5,label:"Shrub",description:"Shrub is ..."},{id:7,order:7,label:"Water",description:"Water is ..."}]},water:{label:"Water Source",style:"danger",choices:[{id:0,label:"Unknown",description:"No irrigation specified..."},{id:1,label:"Rainfed",description:"Rainfed is ..."},{id:2,label:"Irrigated",description:"Irrigated is ..."}]},intensity:{label:"Intensify of Cropping",style:"success",choices:[{id:0,label:"Unknown",description:"Continuous is..."},{id:1,label:"Single",description:"Single is..."},{id:2,label:"Double",description:"Double is..."},{id:3,label:"Triple",description:"Triple is..."},{id:4,label:"Continuous",description:"Continuous is..."}]},crop_primary:{label:"Crop Type",choices:[{id:0,label:"Unknown",description:"No crop type specified."},{id:1,label:"Wheat",description:""},{id:2,label:"Maize (Corn)",description:""},{id:3,label:"Rice",description:""},{id:4,label:"Barley",description:""},{id:5,label:"Soybeans",description:""},{id:6,label:"Pulses",description:""},{id:7,label:"Cotton",description:""},{id:8,label:"Potatoes",description:""},{id:9,label:"Alfalfa",description:""},{id:10,label:"Sorghum",description:""},{id:11,label:"Millet",description:""},{id:12,label:"Sunflower",description:""},{id:13,label:"Rye",description:""},{id:14,label:"Rapeseed or Canola",description:""},{id:15,label:"Sugarcane",description:""},{id:16,label:"Groundnuts or Peanuts",description:""},{id:17,label:"Cassava",description:""},{id:18,label:"Sugarbeets",description:""},{id:19,label:"Palm",description:""},{id:20,label:"Others",description:""},{id:21,label:"Plantations",description:"Plantations or other continuous crops"},{id:22,label:"Fallow",description:""},{id:23,label:"Tef",description:""},{id:24,label:"Pasture",description:"May be managed"},{id:25,label:"Oats",description:""}]},lat:{label:"Latitude"},lon:{label:"Longitude"},source_type:{label:"Source of Data",choices:[{id:"ground",label:"Ground"},{id:"unknown",label:"Unknown"},{id:"derived",label:"Derived"}]},user_validation:{label:"Validation Only",style:"success",choices:[{id:0,label:"Training",description:"Data is used for training."},{id:1,label:"Validation",description:"Data is used for validation."}]},year:{label:"Year",choices:[]}};a.crop_secondary=angular.copy(a.crop_primary);for(var b=(new Date).getFullYear(),c=2e3;b+1>c;c++)a.year.choices.push({label:c,id:c});return a}]),app.factory("wmsLayers",["$interval","leafletData","log",function(a,b,c){var d,e;return e=function(a,b,c){if(this.playSpeed=2e3,_.extend(this,a),this.layers&&(this.idx=void 0===b?0:b,console.log(this.idx),this.layerOptions.layers=this.layers[this.idx].layer,this.layerOptions.layerLabel=this.layers[this.idx].label),this.styles){var d,e;c?d=this.styles[c]:(e=_.values(this.styles),d=e[e.length-1]),this.legend=d.legend,this.layerOptions.styles=d.id}},e.prototype.hasLayers=function(){return this.layers&&this.layers.length>1},e.prototype.hasStyles=function(){return this.styles&&_.values(this.styles).length},e.prototype.changeImage=function(a){var b=angular.copy(this.layerOptions.layers);this.layerOptions.layers=this.layers[a].layer,this.layerOptions.layerLabel=this.layers[a].label,this.redraw(b)},e.prototype.changeStyle=function(a){var b;return console.log(a),this.styles&&this.styles[a]?(b=this.styles[a],this.layerOptions.styles=b.id,b.legend&&(this.legend=b.legend),void this.redraw(this.layerOptions.layers)):void c.error("[WMS] No style available.")},e.prototype.redraw=function(a){var c=this;console.log(c.layerOptions),b.getMap().then(function(b){b.eachLayer(function(b){if(b.url===c._url&&b.options.layers===a){var d=_.extend(b.options,c.layerOptions);b.setParams(d)}})})},e.prototype.next=function(){this.hasLayers()&&(this.idx===this.layers.length-1?this.idx=0:this.idx++,this.changeImage(this.idx))},e.prototype.previous=function(){this.hasLayers&&(0===this.idx?this.idx=this.layers.length-1:this.idx--,this.changeImage(this.idx))},e.prototype.play=function(){if(this.hasLayers){var b=this;this.loop?(a.cancel(this.loop),delete this.loop):(this.visible=!0,this.loop=a(function(){b.next()},this.playSpeed))}},e.prototype.stop=function(){a.cancel(this.loop),delete this.loop},d={australiaACCA250m:new e({id:"australiaACCA250m",name:"Australia GCE 250m Cropland Products 2000 to Present from ACCA ",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",visible:!0,layerOptions:{bounds:L.latLngBounds(L.latLng(-9.83464522447101,110.000125),L.latLng(-45.00754522447101,158.961625)),layers:"Products:GCE 1km Crop Dominance year2000",format:"image/png",transparent:!0,minZoom:0,maxNativeZoom:15,opacity:1},layers:[{layer:"Products:Australia ACCA 250m v201512 year2000",label:"2000"},{layer:"Products:Australia ACCA 250m v201512 year2001",label:"2001"},{layer:"Products:Australia ACCA 250m v201512 year2002",label:"2002"},{layer:"Products:Australia ACCA 250m v201512 year2003",label:"2003"},{layer:"Products:Australia ACCA 250m v201512 year2004",label:"2004"},{layer:"Products:Australia ACCA 250m v201512 year2005",label:"2005"},{layer:"Products:Australia ACCA 250m v201512 year2006",label:"2006"},{layer:"Products:Australia ACCA 250m v201512 year2007",label:"2007"},{layer:"Products:Australia ACCA 250m v201512 year2008",label:"2008"},{layer:"Products:Australia ACCA 250m v201512 year2009",label:"2009"},{layer:"Products:Australia ACCA 250m v201512 year2010",label:"2010"},{layer:"Products:Australia ACCA 250m v201512 year2011",label:"2011"},{layer:"Products:Australia ACCA 250m v201512 year2012",label:"2012"},{layer:"Products:Australia ACCA 250m v201512 year2013",label:"2013"},{layer:"Products:Australia ACCA 250m v201512 year2014",label:"2014"}],legend:[{label:"1 Croplands, rainfed, SC (Season 1 & 2), all crops",color:"#FFFF00"},{label:"2 Croplands, rainfed,SC, pastures",color:"#66FFFF"},{label:"3 Croplands, irrigated, SC, DC (Season 1 & 2), all crops",color:"#FF66FF"},{label:"4 Croplands, irrigated, SC, pastures",color:"#00B0F0"},{label:"5 Croplands, irrigated, continuous, orchards ",color:"#00B050"},{label:"6 Croplands,  fallow ",color:"#FBD4B4"}]}),gfsad1000v00:{name:"Global GCE 1km Cropland Dominance and Other Products",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",layerOptions:{layers:"Products:GCE 1km Crop Dominance year2000",format:"image/png",transparent:!0,minZoom:0,maxNativeZoom:15,opacity:1},attribution:'<a href="https://powellcenter.usgs.gov/globalcroplandwater/sites/default/files/August%20HLA-final-1q-high-res.pdf">Thenkabail et al., 2012</a>',legend:[{label:"Irrigated: Wheat and Rice Dominant",color:"#0000FF"},{label:"Irrigated: Mixed Crops 1: Wheat, Rice, Barley, Soybeans",color:"#A020EF"},{label:"Irrigated: Mixed Crops 2: Corn, Wheat, Rice, Cotton, Orchards",color:"#FF00FF"},{label:"Rainfed: Wheat, Rice, Soybeans, Sugarcane, Corn, Cassava",color:"#00FFFF"},{label:"Rainfed: Wheat and Barley Dominant",color:"#FFFF00"},{label:"Rainfed: Corn and Soybeans Dominant",color:"#007A0B"},{label:"Rainfed: Mixed Crops 1: Wheat, Corn, Rice, Barley, Soybeans",color:"#00FF00"},{label:"Minor Fractions of Mixed Crops: Wheat, Maize, Rice, Barley, Soybeans",color:"#505012"},{label:"Other Classes",color:"#B2B2B2"}]},gfsad1000v10:{name:"Global GCE 1km Multi-study Cropland Mask Product",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",layerOptions:{layers:"Products:GCE 1km Crop Mask year2000",format:"image/png",transparent:!0,minZoom:0,maxNativeZoom:15,opacity:1},attribution:'<a href="http://geography.wr.usgs.gov/science/app/docs/Global-cropland-extent-V10-teluguntla-thenkabail-xiong.pdf">Teluguntla et al., 2015</a>',legend:[{label:"Croplands, Irrigation major",color:"#FF00FF"},{label:"Croplands, Irrigation minor",color:"#00FF00"},{label:"Croplands, Rainfed",color:"#FFFF00"},{label:"Croplands, Rainfed minor fragments",color:"#00FFFF"},{label:"Croplands, Rainfed very minor fragments",color:"#D2B58C"}]},us250v201512y2008:{name:"United States GCE 250m Croplands 2008 from ACCA",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",visible:!0,layerOptions:{layers:"Products:United States ACCA 250m v201512 year2008",minZoom:0,maxZoom:15,opacity:1,format:"image/png",transparent:!0,bounds:L.latLngBounds(L.latLng(49.4043,-124.5835),L.latLng(24.5025008881642,-66.8524020590759))},legend:[{label:"Corn-Soybean",color:"#FFFF00"},{label:"Wheat-Barley",color:"#FF0000"},{label:"Potato",color:"#663300"},{label:"Alfalfa",color:"#00FF00"},{label:"Cotton",color:"#00FFFF"},{label:"Rice",color:"#0000FF"},{label:"Other Crops",color:"#FF6600"}]},southAsia250v201601y2010:{name:"South Asia 250m Croplands 2010-2011 from ACCA",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",visible:!0,layerOptions:{layers:"Products:south_asia_250m",minZoom:0,maxZoom:16,opacity:1,format:"image/png",transparent:!0,bounds:L.latLngBounds(L.latLng(37.0985,60.895),L.latLng(6.006,97.416))},legend:[{label:"Unclassified",color:"#000000"},{label:"Irrigated-SW/GW-DC-rice-wheat",color:"#006400"},{label:"Irrigated-SW/GW-DC-rice-rice",color:"#00ff00"},{label:"Irrgated-SW-DC-beans/cotton-wheat",color:"#a0c27c"},{label:"Irrigated-SW-DC-Sugarcane/rice-rice/Plantations",color:"#7e9e65"},{label:"Irrigated-DC-fallows/pulses-rice-fallow",color:"#c5e5a4"},{label:"Irrigated-GW-DC-rice-maize/chickpea",color:"#7fffd4"},{label:"Irrgated-TC-rice-mixedcrops-mixedcrops",color:"#40e0d0"},{label:"Irrigated-GW-DC-millet/sorghum/potato-wheat/mustartd",color:"#cfe09c"},{label:"Irrigated-SW-DC-cotton/chilli/maize-fallow/pulses",color:"#00ffff"},{label:"Rainfed-DC-rice-fallows-jute/rice/mixed crops",color:"#ffff00"},{label:"Rainfed-SC-rice-fallow/pulses",color:"#ffd700"},{label:"Rainfed-DC-millets-chickpea/Fallows",color:"#cdad00"},{label:"Rainfed-SC-cotton/pigeonpea/mixedcrops",color:"#8b6913"},{label:"Rainfed-SC-groundnut/millets/sorghum",color:"#cd853f"},{label:"Rainfed-SC-pigeonpea/mixedcrops",color:"#ee9a49"},{label:"Rainfed-SC-millet-fallows/mixedcrops-",color:"#d8a585"},{label:"Rainfed-SC-fallow-chickpea-",color:"#e6bc8a"},{label:"Rainfed-SC-millets/fallows-LS",color:"#e0cab4"},{label:"Rainfed-SC-mixedcrops/Plantations",color:"#bd5e4d"},{label:"Shrublands/trees/Rainfed-mixedcrops30%",color:"#a020f0"},{label:"Other LULC",color:"#c0c0c0"}]},africaL4250v201512y2014:new e({name:"Africa GCE 250m Cropland Products 2014 from ACCA",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",visible:!0,layerOptions:{bounds:L.latLngBounds(L.latLng(37.3494,-25.3695),L.latLng(-34.83026000000001,63.50536000000001)),layers:"Products:Africa ACCA L4 250m v201512 year2014",minZoom:0,maxZoom:15,opacity:1,format:"image/png",transparent:!0},styles:{"Africa ACCA L1 Extent v201512":{name:"Mask",id:"Africa ACCA L1 Extent v201512",legend:[{label:"Cropland",color:"#00FF00"}]},"Africa ACCA L2 Water v201512":{name:"Irrigated",id:"Africa ACCA L2 Water v201512",legend:[{label:"Irrigated",color:"#aec7e8"},{label:"Rainfed",color:"#9467bd"}]},"Africa ACCA L3 Intensity v201512":{name:"Intensity",id:"Africa ACCA L3 Intensity v201512",legend:[{label:"Single",color:"#aec7e8"},{label:"Double",color:"#ffbb78"},{label:"Continuous",color:"#98df8a"}]}}}),southamerica30v201512:{name:"South America GCE 30m Cropland Mask Product 2014",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",visible:!0,layerOptions:{layers:"Products:South America Extent 30m v201512",minZoom:0,maxNativeZoom:15,opacity:1,format:"image/png",transparent:!0,bounds:L.latLngBounds(L.latLng(12.835778465638036,-81.95811941094321),L.latLng(-56.073447989999984,-31.449983235209473))},legend:[{label:"Cropland",color:"#00FF00"}]},egypt30mv201512y2014:new e({name:"Egypt GCE 30m Cropland Products 2014",type:"wms",url:"https://wms.croplands.org/geoserver/Products/wms",layerOptions:{bounds:L.latLngBounds(L.latLng(37.3494,24.3695),L.latLng(21.9,36)),layers:"Products:Egypt Extent 30m v201512 year2014",minZoom:0,maxNativeZoom:15,opacity:1,format:"image/png",transparent:!0},styles:{"Africa ACCA L1 Extent v201512":{name:"Mask",id:"Africa ACCA L1 Extent v201512",legend:[{label:"Cropland",color:"#00FF00"}]},"Africa ACCA L2 Water v201512":{name:"Irrigated",id:"Africa ACCA L2 Water v201512",legend:[{label:"Irrigated",color:"#aec7e8"},{label:"Rainfed",color:"#9467bd"}]}}})}}]),app.filter("mappings",["mappings",function(a){return function(b,c){b=b||0;try{return a[c].choices[b].label}catch(d){return b}}}]),app.filter("monthName",[function(){return function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"];return b[a-1]}}]),app.filter("prepend",[function(){return function(a,b){return b+a}}]),app.filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.controller("AccountFormController",["$location","$scope","log","$window",function(a,b,c,d){var e=a.path().split("/");"account"===e[1]&&e[1]?b.$emit("user."+e[2],!0):d.location.href="/"}]),app.controller("ClassifyController",["$scope","mapService","mappings","$http","leafletData","$document","log",function(a,b,c,d,e,f,g){function h(b){d.get('https://api.croplands.org/api/images?q={"order_by":[{"field":"classifications_count","direction":"asc"}],"filters":[{"name":"source","op":"eq","val":"VHRI"},{"name":"classifications_count","op":"lt","val":5}]}&page='+String(b)+"&page_size=50&random"+Date.now().toString()).then(function(b){a.images=a.images.concat(b.data.objects),m=b.data.total_pages})}function i(){if(a.images.length>0){a.image=a.images[0],a.images=_.slice(a.images,1),a.image.url=a.image.url.replace("images/",""),a.center.lat=a.image.location.lat,a.center.lng=a.image.location.lon,a.center.zoom=19;var b=[[a.image.corner_ne_lat,a.image.corner_ne_lon],[a.image.corner_sw_lat,a.image.corner_sw_lon]];if(a.counter){if(a.images[15]){var c=new Image;c.src="https://images.croplands.org/"+a.images[15].url.replace("images/","")}}else for(var d=0;15>d;d++)if(a.images[d]){var c=new Image;c.src="https://images.croplands.org/"+a.images[d].url.replace("images/","")}e.getMap("map").then(function(c){j&&c.removeLayer(j),k&&c.removeLayer(k),k=L.imageOverlay("https://images.croplands.org/"+a.image.url,b),k.addTo(c),j=L.imageOverlay("/static/imgs/minimumMapUnit.png",L.circle({lng:a.image.location.lon,lat:a.image.location.lat},45).getBounds()),j.addTo(c)})}}var j,k,l=1,m=1;angular.extend(a,{counter:0,center:{lat:0,lng:0,zoom:2},images:[],markers:{image:{layer:"markers",lat:0,lng:0}},layers:{baselayers:{googleHybrid:angular.copy(b.layers.baselayers.googleHybrid)},overlays:{markers:{type:"group",name:"markers",visible:!0}}},paths:{},buttons:[{id:1,label:"Pure Cropland",description:"Cropland is...",buttonClass:"pure-cropland"},{id:2,label:"Mixed Cropland",description:"Mixed is ...",buttonClass:"mixed-cropland"},{id:0,label:"Not Cropland",description:"Not cropland is...",buttonClass:"not-cropland"},{id:-1,label:"Reject",description:"Reject is ...",buttonClass:"btn-default"}]}),e.getMap("map").then(function(b){a.map=b,L.circle([a.center.lng,a.center.lat],1e4).addTo(b)}),a.$watch(function(){return a.images.length},function(a,b){console.log(a),0===b&&a>0&&i(),30>a&&m>=l&&h(l++)}),a.skip=function(){i()},a.classify=function(b){if(void 0!==b){var c={classification:b,image:angular.copy(a.image.id)};d.post("https://api.croplands.org/api/image_classifications",c).then(function(){a.counter++})}i()},f.bind("keypress",function(b){switch(console.debug(b),b.keyCode){case 115:g.info("[ClassifyControler] Skip Image Shortcut"),i();break;case 99:g.info("[ClassifyControler] Pure Cropland Shortcut"),a.classify(1);break;case 101:g.info("[ClassifyControler] Mixed Cropland Shortcut"),a.classify(2);break;case 102:g.info("[ClassifyControler] Zoom Out Shortcut"),a.center.zoom--,a.$apply();break;case 103:g.info("[ClassifyControler] Zoom Out Shortcut"),a.center.zoom++,a.$apply();break;case 100:g.info("[ClassifyControler] Not Cropland Shortcut"),a.classify(0);break;case 114:g.info("[ClassifyControler] Reject Shortcut"),a.classify(-1)}String.fromCharCode(b.keyCode)})}]),app.controller("DataController",["$scope","$http","mapService","leafletData",function(a,b,c,d){function e(a){if(0===a.cultivated_area_hectares)return"black";if(0===a.crop_type)return"red";var b,c,d,e,f,g;return c=10*a.ratio,d=Math.max(Math.min((c-500)/5e4,1),0),e=Math.round(255*d),f=Math.round(255*(1-d)),g=0,b="#"+("00"+e.toString(16)).slice(-2)+("00"+f.toString(16)).slice(-2)+("00"+g.toString(16)).slice(-2)}var f;angular.extend(a,{sumCropType:0,center:c.center,layers:c.layers,geojson:{},sort:{column:"properties.crop_type",reverse:!0},sortColumn:function(b){console.log(b),a.sort.column===b?a.sort.reverse=!a.sort.reverse:(a.sort.column=b,a.sort.reverse=!1),console.log(a.sort)},moveToCountry:function(a){f.fitBounds(a.pad(.2))},goalFillAmount:function(){return 896*(.1+a.sumCropType/5e5)}}),_.each(a.layers.overlays,function(a){a.visible=!1}),b.get("https://s3.amazonaws.com/gfsad30/public/json/reference_data_coverage.json").then(function(b){_.each(b.data.features,function(b){a.sumCropType+=b.properties.crop_type,b.properties.cultivated_area_km2=parseInt(b.properties.cultivated_area_hectares/100,10),b.properties.ratio=b.properties.cultivated_area_km2/b.properties.crop_type,b.properties.visible=!0}),a.countries=b.data.features,d.getMap().then(function(a){f=a,L.geoJson(b.data.features,{style:function(a){return{weight:2,opacity:.8,fillColor:e(a.properties),color:"white",dashArray:"3",fillOpacity:.6}},onEachFeature:function(a,b){a.properties.bounds=b.getBounds()}}).addTo(a)})},function(a){console.log(a)}),a.$watch("center",function(){if(void 0!==f){var b=f.getBounds().pad(.5);_.each(a.countries,function(a){a.properties.visible=b.contains(a.properties.bounds)})}})}]),app.controller("DataRecordController",["$scope","mapService","leafletData","$location","DataRecord","$q","geoHelperService",function(a,b,c,d,e,f,g){
function h(){var b=0,d=7.5,e=a.record,f={lat:e.location.lat,lng:e.location.lon},h={lat:e.location.original_lat,lng:e.location.original_lon};c.getMap("recordMap").then(function(a){_.forOwn(j,function(b){a.removeLayer(b)}),j={};var c=L.circle(f,125);j.locationAreaGrid=L.imageOverlay(i,c.getBounds()),j.locationMarker=L.marker(f,{zIndexOffset:1e3,draggable:!1}),void 0!==e.location.distance&&(b=e.location.distance/1e3),e.location.bearing&&(j.polygon=L.polygon([h,g.destination(h,e.location.bearing-d,b),g.destination(h,e.location.bearing+d,b)],{color:"#00FF00",stroke:!1})),_.forOwn(j,function(b){b.addTo(a)})},function(a){console.log(a)})}var i="/static/imgs/icons/grid.png",j={};angular.extend(a,{id:d.search().id,paging:{hasNext:e.paging.hasNext,hasPrevious:e.paging.hasPrevious,next:e.paging.next,previous:e.paging.previous},center:{lat:0,lng:0,zoom:2},layers:angular.copy(b.layers),markers:{},events:{map:{enable:[],logic:"emit"}}}),_.each(a.layers.overlays,function(a){a.visible=!1}),a.imageURL=function(a){return"https://images.croplands.org/"+a.replace("images/","")},e.get(a.id).then(function(b){a.record=b,a.center.lat=b.location.lat,a.center.lng=b.location.lon,a.center.zoom=17,h()},function(a){console.log(a)})}]),app.controller("DataSearchController",["$scope","$http","mapService","leafletData","$location","DataService","DataRecord","leafletData",function(a,b,c,d,e,f,g,d){function h(){f.is_initialized?(a.records=f.records,a.markers=k(a.records),a.ndvi=l(f.getParams()),a.busy=!1,a.count=f.count,a.percentage=a.count.filtered/a.count.total*100):(m(e.search()),f.load()),f.bounds&&(a.bounds=f.bounds,d.getMap("searchMap").then(function(b){b.fitBounds([[a.bounds.southWest.lat,a.bounds.southWest.lng],[a.bounds.northEast.lat,a.bounds.northEast.lng]]),a.searchInMap=!0}))}function i(){a.busy=!0,a.$evalAsync(f.load)}function j(a){f.bounds!==a&&(f.bounds=a,i())}function k(a){var b={};return _.each(a,function(a){b["m_"+a.id.toString()]={lat:parseFloat(a.lat),lng:parseFloat(a.lon),layer:"markers"}}),b}function l(a){var b="https://api.croplands.org/data/image?";return _.each(a,function(a,c){"southWestBounds"!==c&&"northEastBounds"!==c&&"ndvi_limit_upper"!==c&&"ndvi_limit_lower"!==c&&a.length&&_.each(a,function(a){b+=c+"="+a.toString()+"&"})}),a.southWestBounds&&a.northEastBounds&&(b+="southWestBounds="+a.southWestBounds+"&",b+="northEastBounds="+a.northEastBounds+"&"),a.ndvi_limit_upper&&a.ndvi_limit_lower&&(b+="ndvi_limit_upper="+a.ndvi_limit_upper+"&",b+="ndvi_limit_lower="+a.ndvi_limit_lower+"&"),b}function m(a){console.log(a),_.each(a,function(a,b){if(f.columns[b]&&"year"!==b&&"source_type"!==b)Array.isArray(a)?_.each(a,function(a){f.columns[b].choices[parseInt(a,10)].selected=!0}):f.columns[b].choices[parseInt(a,10)].selected=!0;else if("source_type"===b){var c={};_.each(f.columns.source_type.choices,function(a,b){c[a.id]=b}),Array.isArray(a)?_.each(a,function(a){f.columns.source_type.choices[c[a]].selected=!0}):f.columns.source_type.choices[c[a]].selected=!0}else if("year"===b)Array.isArray(a)?_.each(a,function(a){f.columns.year.choices[parseInt(a,10)-2e3].selected=!0}):f.columns.year.choices[parseInt(a,10)-2e3].selected=!0;else if("southWestBounds"===b){var d=a.split(",");f.bounds={southWest:{},northEast:{}},f.bounds.southWest.lat=d[0],f.bounds.southWest.lng=d[1]}else if("northEastBounds"===b){var e=a.split(",");f.bounds.northEast.lat=e[0],f.bounds.northEast.lng=e[1]}else"page"===b?f.paging.page=parseInt(a,10):"page_size"===b?f.paging.page_size=parseInt(a,10):"ndvi_limit_upper"===b?(f.ndviLimits||(f.ndviLimits={}),f.ndviLimits.upper=a.split(",")):"ndvi_limit_lower"===b&&(f.ndviLimits||(f.ndviLimits={}),f.ndviLimits.lower=a.split(","))}),console.log(f.ndviLimits)}angular.extend(a,{tableColumns:[{id:"id",label:"ID",visible:!1},{id:"lon",label:"Longitude",visible:!1},{id:"lat",label:"Latitude",visible:!1},{id:"land_use_type",label:"Land Use",visible:!0},{id:"crop_primary",label:"Primary Crop",visible:!0},{id:"crop_secondary",label:"Secondary Crop",visible:!1},{id:"water",label:"Irrigation",visible:!0},{id:"intensity",label:"Intensity",visible:!0},{id:"year",label:"Year",visible:!0},{id:"month",label:"Month",visible:!1},{id:"country",label:"Country",visible:!0},{id:"source_type",label:"Source Type",visible:!0},{id:"source_class",label:"Source Class",visible:!1},{id:"source_description",label:"Source Description",visible:!1},{id:"use_validation",label:"Validation",visible:!1}],ordering:f.ordering,busy:!0,bounds:{southWest:{lat:-90,lng:-180},northEast:{lat:90,lng:180}},center:{lat:0,lng:0,zoom:2},searchInMap:!1,layers:angular.copy(c.layers),markers:{},events:{map:{enable:[],logic:"emit"}}}),_.each(a.layers.overlays,function(a){a.visible=!1}),a.layers.overlays.markers={name:"markers",visible:!0,type:"group"},a.sortColumn=function(a){a===f.ordering.order_by?"asc"===f.ordering.order_by_direction?f.ordering.order_by_direction="desc":f.ordering.order_by_direction="asc":(f.ordering.order_by_direction="asc",f.ordering.order_by=a),i()},a.selectColumns=function(){console.log("select columns")},a.download=f.download,a.goToRecord=g.goTo,a.reset=function(){f.reset(),i()},a.apply=i,a.zoomExtent=function(){a.center.lat=0,a.center.lng=0,a.center.zoom=2},a.$on("DataService.load",function(){a.records=f.records,console.log(f.getParams()),e.search(f.getParams()),a.markers=k(a.records),a.$evalAsync(function(){a.busy=!1}),a.ndvi=l(f.getParams()),a.count=f.count,a.percentage=a.count.filtered/a.count.total*100}),a.$watch("bounds",_.debounce(function(){a.searchInMap&&j(a.bounds)},800)),a.$watch("searchInMap",function(b,c){b!==c&&j(b?a.bounds:!1)}),h()}]),app.controller("MapController",["$scope","mapService","DataService","leafletData","$timeout","$window","$location","mappings","log",function(a,b,c,d,e,f,g,h,i){function j(a){L.DomEvent.stopPropagation(a)}function k(){var c={tableOfContentsVisible:!0,showHelp:!1,showDownloadModal:!1,busy:!1,busyDialogVisible:!1,table:{visible:!1},events:{map:{enable:["mousedown","mousemove","click"],logic:"emit"}},center:b.center,layers:b.layers},d=g.getCenter();d&&d.lat&&(b.center.lat=d.lat),d&&d.lng&&(b.center.lng=d.lng),d&&d.zoom&&(b.center.zoom=d.zoom),angular.extend(a,c)}g.moveCenter=function(a,b,c){this.search(_.merge(this.search(),{lat:Math.round(a*Math.pow(10,5))/Math.pow(10,5),lng:b,zoom:c}))},g.setId=function(a){this.search(_.merge(this.search(),{id:a}))},g.removeId=function(){this.search(_.omit(this.search(),"id"))},g.getId=function(){return parseInt(_.pluck(this.search(),"id"),10)},g.getCenter=function(){var a=this.search();return a.lat&&a.lng&&a.zoom?{lat:parseFloat(a.lat),lng:parseFloat(a.lng),zoom:parseInt(a.zoom,10)}:void 0},a.$watch(function(){return b.center},function(b){a.center=b},!0),a.$watch("center",function(a){g.moveCenter(a.lat,a.lng,a.zoom)}),a.$watch("busy",function(){a.busy&&(a.busyDialogVisible=!0)}),a.toggleLayerInfo=function(a,b){b.preventDefault(),j(b),a.infoVisible=!a.infoVisible},a.zoomExtent=function(){b.center.lat=0,b.center.lng=0,b.center.zoom=2},a.print=function(){window.print()},k()}]),app.controller("NavbarController",["$scope","User","$location",function(a,b,c){a.goToLogin=function(){var a=encodeURIComponent(window.btoa(JSON.stringify({path:c.path(),params:c.search()})));c.path("/app/a/login").search({n:a})},a.isLoggedIn=function(){return b.isLoggedIn()},a.goToLogout=function(){var a=encodeURIComponent(window.btoa(JSON.stringify({path:c.path(),params:c.search()})));c.path("/app/a/logout").search({n:a})}}]),app.controller("ConfirmController",["$scope","log",function(a,b){}]),app.controller("ForgotController",["$scope","User",function(a,b){function c(b,c){a.success=c,a.message=b}a.forgot=function(){a.busy=!0,b.forgot(a.email).then(function(b){c(b.description,!0),a.busy=!1,a.email=""},function(b){b.description?c(b.description,!1):c("Something went wrong",!1),a.busy=!1})}}]),app.controller("LoginController",["$scope","log","User","$timeout","$location",function(a,b,c,d,e){function f(b,c){a.success=c,a.message=b}a.login=function(b){return a.message=null,a.busy=!0,b?void c.login(a.email,a.password).then(function(){f("You have successfully logged in.",!0),a.busy=!1,a.email="",a.password="",c.goNext()},function(b){b.description?f(b.description,!1):f("Something went wrong",!1),a.busy=!1}):void f("Invalid Data",!1)}}]),app.controller("LogoutController",["$scope","User","$location",function(a,b,c){b.logout(),b.goNext()}]),app.controller("RegisterController",["User","countries","$scope","$location","log",function(a,b,c,d,e){function f(a,b){c.success=b,c.message=a}if(a.isLoggedIn()){var g=encodeURIComponent(window.btoa(JSON.stringify({path:d.path(),params:d.search()})));d.path("/app/a/logout").search({n:g})}angular.extend(c,{countries:b,success:null,message:null}),c.countries=b,c.register=function(){c.busy=!0,a.register(c.registration).then(function(b){c.busy=!1,f(b.description,!0),a.goNext()},function(a){a?f(a.description,!1):f("Something went wrong",!1),c.busy=!1})}}]),app.controller("ResetController",["$location","$scope","$window","User",function(a,b,c,d){function e(a,c){b.success=c,b.message=a}b.token=a.search().token,b.reset=function(){b.busy=!0,d.reset(b.password,b.token).then(function(a){e(a.description,!0),b.busy=!1,b.close()},function(a){a.description?e(a.description,!1):e("Something went wrong",!1),b.busy=!1})},b.close=function(){c.location.href="/"}}]),app.directive("filter",["log","$q","$timeout","mappings","DataService",function(a,b,c,d,e){return{restrict:"EA",scope:{},link:function(a){angular.extend(a,{land_use_type:e.columns.land_use_type.choices,crop_primary:e.columns.crop_primary.choices,water:e.columns.water.choices,intensity:e.columns.intensity.choices,year:e.columns.year.choices,source_type:e.columns.source_type.choices,count:e.count}),a.reset=e.reset,a.apply=function(){a.$parent.busy=!0,a.$evalAsync(e.load)},a.allOptionsAreSelected=function(b){if(void 0===b)return!1;for(var c=0;c<a[b].length;c++)if(!a[b][c].selected)return!1;return!0},a.toggleAllOptions=function(b){var c=!0;a.allOptionsAreSelected(b)&&(c=!1);for(var d=0;d<a[b].length;d++)a[b][d].selected=c},a.$on("DataService.load",function(b){a.count=e.count})},templateUrl:"/static/directives/filter.html"}}]),app.directive("blur",[function(){return{restrict:"A",link:function(a,b){b.on("click",function(){b.blur()})}}}]),app.directive("legend",[function(){return{restrict:"E",scope:{items:"=items"},templateUrl:"/static/directives/legend.html"}}]),app.directive("log",["log",function(a){return{link:function(b){b.list=a.getLog(),b.$watch(function(){return a.getLog()},function(a){b.list=a},!0)},templateUrl:"/static/directives/log.html"}}]),app.directive("ndvi",["$http","$log","$q",function(){return{restrict:"E",scope:{pts:"=pts"},link:function(a){a.$watch("pts",function(){a.points=_.map(a.pts,function(a,b){var c=52.17*b,d=1e3-Math.max(3,Math.min(a,1e3));return c.toString()+","+d.toString()}).join(" ")})},templateUrl:"/static/directives/ndvi.html"}}]),app.directive("passwordConfirm",["$window",function(a){var b=[];return{scope:{valid:"=valid",minEntropy:"=minEntropy",password:"=password"},link:function(c){void 0===c.minEntropy&&(c.minEntropy=15),c.entropy=0,c.passwordsMatch=function(){return c.password===c.confirm},c.passwordIsStrong=function(){return c.entropy>c.minEntropy},c.$watch("password",function(d){return void 0===a.zxcvbn?void(c.entropy=0):void(d&&d.length>=8?c.entropy=zxcvbn(d,b).entropy:c.entropy=0)}),c.$watch(function(){return c.passwordIsStrong()&&c.passwordsMatch()},function(a){c.valid=a})},templateUrl:"/static/directives/password-confirm.html"}}]),app.directive("pieChart",["$http","$log","$q",function(){return{restrict:"E",scope:{value:"=value"},link:function(a){var b=100;a.radius=b/2,a.background="#cccccc",a.$watch("value",function(b){if(b=parseFloat(b),a.invalid=isNaN(b),a.invalid)return void(a.d="");if(b=Math.min(Math.max(b,0),100),100===b)return a.background="#237c28",void(a.d="");var c=Math.cos(2*Math.PI/(100/b)),d=Math.sin(2*Math.PI/(100/b)),e=50>=b?0:1;a.d="M"+a.radius+","+a.radius+" L"+a.radius+", 0, A"+a.radius+","+a.radius+" 0 "+e+",1 "+(a.radius+d*a.radius)+","+(a.radius-c*a.radius)+" z"})},templateUrl:"/static/directives/pieChart.html"}}]),app.directive("tableOfContents",["mapService","leafletData",function(a,b){return{templateUrl:"/static/directives/table-of-contents.html",scope:{expandBackgroundLayers:"@",expandProductLayers:"@",expandOtherLayers:"@"},link:function(c){c.layers=void 0===c.layers?a.layers:c.layers,c.changeBaseLayer=function(a){b.getMap().then(function(c){b.getLayers().then(function(b){_.each(b.baselayers,function(a){c.removeLayer(a)}),c.addLayer(b.baselayers[a])})})}}}}]),app.directive("tableOfContentsLayer",[function(){return{templateUrl:"/static/directives/table-of-contents-layer.html",scope:{layer:"=",showMore:"@"},link:function(a){a.showMore=void 0===a.showMore?!1:a.showMore,a.isPlaying=function(){return void 0!==a.layer.loop},a.toggleShowMore=function(){a.canShowMore()&&(a.showMore=!a.showMore)},a.canShowMore=function(){return"WMSCollection"==typeof a.layer&&(a.layer.hasLayers()||a.layer.hasStyles())||a.layer.legend},a.changeStyle=function(){a.layer.changeStyle(a.style.id)}}}}]),app.directive("temporalBounds",["DataService",function(a){var b={upper:[],lower:[],max:0,min:1e3,init:!1},c=12;return{scope:{},link:function(d,e,f){function g(){if(!b.init){if(a.ndviLimits)for(var e=0;r>e;e++)b.upper.push({x:e*s+d.padding,y:1e3-a.ndviLimits.upper[e]+d.padding,r:c}),b.lower.push({x:e*s+d.padding,y:1e3-a.ndviLimits.lower[e]+d.padding,r:c});else for(var e=0;r>e;e++)b.upper.push({x:e*s+d.padding,y:b.max+d.padding,r:c}),b.lower.push({x:e*s+d.padding,y:b.min+d.padding,r:c});b.init=!0}d.bounds=b}function h(){_.each(d.bounds.upper,function(a){(!a.adjusted||a.y<b.max+d.padding)&&(a.y=b.max+d.padding,a.adjusted=!1)}),_.each(d.bounds.lower,function(a){(!a.adjusted||a.y>b.min+d.padding)&&(a.y=b.min+d.padding,a.adjusted=!1)})}function i(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),null!==n?(d.bounds[o][n].y=Math.min(Math.max((a.clientY-p)/q,b.max+d.padding),b.min+d.padding),d.bounds[o][n].adjusted=!0,d.$apply()):("max"===o&&(d.bounds.max=Math.min(Math.max((a.clientY-p)/q,0),1e3)),"min"===o&&(d.bounds.min=Math.max(Math.min((a.clientY-p)/q,1e3),0)),h(),d.$apply())}function j(b){("max"===o||"min"===o)&&h(),a.ndviLimits={upper:_.map(d.bounds.upper,function(a){return Math.round(1e3-a.y)+d.padding}),lower:_.map(d.bounds.lower,function(a){return Math.round(1e3-a.y)+d.padding})},d.$apply(),n=null,o=null,l()}function k(){angular.element(m).on("mousemove",i),angular.element(m).on("mouseup",j)}function l(){angular.element(m).off("mousemove",i),angular.element(m).off("mouseup",j)}var m,n,o,p,q,r=parseInt(f.intervals,10),s=parseFloat(f.intervalWidth);d.padding=20,m=e[0].viewportElement,q=m.clientWidth/m.viewBox.baseVal.width,d.mouseDown=function(a,b,c){a.stopPropagation&&a.stopPropagation(),n=b,o=c,p=m.getBoundingClientRect().top,k()},d.mouseOver=function(a,b,e){d.bounds[e][b].r=2*c},d.mouseOut=function(a,b,e){d.bounds[e][b].r=c},d.selectionPoints=function(){var a=_.map(d.bounds.upper,function(a){return a.x.toString()+","+a.y.toString()}),b=_.map(d.bounds.lower,function(a){return a.x.toString()+","+a.y.toString()});return _.concat(a,b.reverse()).join(" ")},g()},templateUrl:"/static/directives/temporal-bounds.html"}}]),app.directive("draggableBounds",["$document",function(a){return{restrict:"EA",scope:{x:"=x",y:"=y"},link:function(a,b,c){angular.extend(a,{radius:20});var d=b[0].children[0];d.attr("cx",a.x),d.attr("cy",a.y),d.removeAttr("ng-attr-cx"),d.removeAttr("ng-attr-cy");angular.copy(a.y)},template:'<circle ng-mousedown="mouseDown($event)" ng-attr-cx="{{ x }}" ng-attr-cy="{{ y }}" ng-attr-r="{{ radius }}" fill="red" />'}}]);